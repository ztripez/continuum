(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(c){if(c.ep)return;c.ep=!0;const r=n(c);fetch(c.href,r)}})();var z,b,ye,T,le,be,ge,ke,ee,Q,X,L={},we=[],xe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,V=Array.isArray;function E(e,t){for(var n in t)e[n]=t[n];return e}function te(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Ae(e,t,n){var i,c,r,o={};for(r in t)r=="key"?i=t[r]:r=="ref"?c=t[r]:o[r]=t[r];if(arguments.length>2&&(o.children=arguments.length>3?z.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(r in e.defaultProps)o[r]===void 0&&(o[r]=e.defaultProps[r]);return O(e,o,i,c,null)}function O(e,t,n,i,c){var r={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:c??++ye,__i:-1,__u:0};return c==null&&b.vnode!=null&&b.vnode(r),r}function $(e){return e.children}function M(e,t){this.props=e,this.context=t}function x(e,t){if(t==null)return e.__?x(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?x(e):null}function Se(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Se(e)}}function ce(e){(!e.__d&&(e.__d=!0)&&T.push(e)&&!j.__r++||le!=b.debounceRendering)&&((le=b.debounceRendering)||be)(j)}function j(){for(var e,t,n,i,c,r,o,a=1;T.length;)T.length>a&&T.sort(ge),e=T.shift(),a=T.length,e.__d&&(n=void 0,i=void 0,c=(i=(t=e).__v).__e,r=[],o=[],t.__P&&((n=E({},i)).__v=i.__v+1,b.vnode&&b.vnode(n),ne(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[c]:null,r,c??x(i),!!(32&i.__u),o),n.__v=i.__v,n.__.__k[n.__i]=n,Pe(r,n,o),i.__e=i.__=null,n.__e!=c&&Se(n)));j.__r=0}function $e(e,t,n,i,c,r,o,a,_,d,h){var l,u,f,y,w,p,v,m=i&&i.__k||we,P=t.length;for(_=Fe(n,t,m,_,P),l=0;l<P;l++)(f=n.__k[l])!=null&&(u=f.__i==-1?L:m[f.__i]||L,f.__i=l,p=ne(e,f,u,c,r,o,a,_,d,h),y=f.__e,f.ref&&u.ref!=f.ref&&(u.ref&&se(u.ref,null,f),h.push(f.ref,f.__c||y,f)),w==null&&y!=null&&(w=y),(v=!!(4&f.__u))||u.__k===f.__k?_=Ce(f,_,e,v):typeof f.type=="function"&&p!==void 0?_=p:y&&(_=y.nextSibling),f.__u&=-7);return n.__e=w,_}function Fe(e,t,n,i,c){var r,o,a,_,d,h=n.length,l=h,u=0;for(e.__k=new Array(c),r=0;r<c;r++)(o=t[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=e.__k[r]=O(null,o,null,null,null):V(o)?o=e.__k[r]=O($,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=e.__k[r]=O(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):e.__k[r]=o,_=r+u,o.__=e,o.__b=e.__b+1,a=null,(d=o.__i=Le(o,n,_,l))!=-1&&(l--,(a=n[d])&&(a.__u|=2)),a==null||a.__v==null?(d==-1&&(c>h?u--:c<h&&u++),typeof o.type!="function"&&(o.__u|=4)):d!=_&&(d==_-1?u--:d==_+1?u++:(d>_?u--:u++,o.__u|=4))):e.__k[r]=null;if(l)for(r=0;r<h;r++)(a=n[r])!=null&&!(2&a.__u)&&(a.__e==i&&(i=x(a)),Re(a,a));return i}function Ce(e,t,n,i){var c,r;if(typeof e.type=="function"){for(c=e.__k,r=0;c&&r<c.length;r++)c[r]&&(c[r].__=e,t=Ce(c[r],t,n,i));return t}e.__e!=t&&(i&&(t&&e.type&&!t.parentNode&&(t=x(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Le(e,t,n,i){var c,r,o,a=e.key,_=e.type,d=t[n],h=d!=null&&(2&d.__u)==0;if(d===null&&a==null||h&&a==d.key&&_==d.type)return n;if(i>(h?1:0)){for(c=n-1,r=n+1;c>=0||r<t.length;)if((d=t[o=c>=0?c--:r++])!=null&&!(2&d.__u)&&a==d.key&&_==d.type)return o}return-1}function oe(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||xe.test(t)?n:n+"px"}function W(e,t,n,i,c){var r,o;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof i=="string"&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||oe(e.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||oe(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")r=t!=(t=t.replace(ke,"$1")),o=t.toLowerCase(),t=o in e||t=="onFocusOut"||t=="onFocusIn"?o.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?i?n.u=i.u:(n.u=ee,e.addEventListener(t,r?X:Q,r)):e.removeEventListener(t,r?X:Q,r);else{if(c=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function ae(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=ee++;else if(t.t<n.u)return;return n(b.event?b.event(t):t)}}}function ne(e,t,n,i,c,r,o,a,_,d){var h,l,u,f,y,w,p,v,m,P,N,U,A,ie,D,F,G,C=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(_=!!(32&n.__u),r=[a=t.__e=n.__e]),(h=b.__b)&&h(t);e:if(typeof C=="function")try{if(v=t.props,m="prototype"in C&&C.prototype.render,P=(h=C.contextType)&&i[h.__c],N=h?P?P.props.value:h.__:i,n.__c?p=(l=t.__c=n.__c).__=l.__E:(m?t.__c=l=new C(v,N):(t.__c=l=new M(v,N),l.constructor=C,l.render=Ue),P&&P.sub(l),l.state||(l.state={}),l.__n=i,u=l.__d=!0,l.__h=[],l._sb=[]),m&&l.__s==null&&(l.__s=l.state),m&&C.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=E({},l.__s)),E(l.__s,C.getDerivedStateFromProps(v,l.__s))),f=l.props,y=l.state,l.__v=t,u)m&&C.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),m&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(m&&C.getDerivedStateFromProps==null&&v!==f&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(v,N),t.__v==n.__v||!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(v,l.__s,N)===!1){for(t.__v!=n.__v&&(l.props=v,l.state=l.__s,l.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(H){H&&(H.__=t)}),U=0;U<l._sb.length;U++)l.__h.push(l._sb[U]);l._sb=[],l.__h.length&&o.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(v,l.__s,N),m&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(f,y,w)})}if(l.context=N,l.props=v,l.__P=e,l.__e=!1,A=b.__r,ie=0,m){for(l.state=l.__s,l.__d=!1,A&&A(t),h=l.render(l.props,l.state,l.context),D=0;D<l._sb.length;D++)l.__h.push(l._sb[D]);l._sb=[]}else do l.__d=!1,A&&A(t),h=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++ie<25);l.state=l.__s,l.getChildContext!=null&&(i=E(E({},i),l.getChildContext())),m&&!u&&l.getSnapshotBeforeUpdate!=null&&(w=l.getSnapshotBeforeUpdate(f,y)),F=h,h!=null&&h.type===$&&h.key==null&&(F=Ee(h.props.children)),a=$e(e,V(F)?F:[F],t,n,i,c,r,o,a,_,d),l.base=t.__e,t.__u&=-161,l.__h.length&&o.push(l),p&&(l.__E=l.__=null)}catch(H){if(t.__v=null,_||r!=null)if(H.then){for(t.__u|=_?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,t.__e=a}else{for(G=r.length;G--;)te(r[G]);Y(t)}else t.__e=n.__e,t.__k=n.__k,H.then||Y(t);b.__e(H,t,n)}else r==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):a=t.__e=qe(n.__e,t,n,i,c,r,o,_,d);return(h=b.diffed)&&h(t),128&t.__u?void 0:a}function Y(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Y)}function Pe(e,t,n){for(var i=0;i<n.length;i++)se(n[i],n[++i],n[++i]);b.__c&&b.__c(t,e),e.some(function(c){try{e=c.__h,c.__h=[],e.some(function(r){r.call(c)})}catch(r){b.__e(r,c.__v)}})}function Ee(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:V(e)?e.map(Ee):E({},e)}function qe(e,t,n,i,c,r,o,a,_){var d,h,l,u,f,y,w,p=n.props||L,v=t.props,m=t.type;if(m=="svg"?c="http://www.w3.org/2000/svg":m=="math"?c="http://www.w3.org/1998/Math/MathML":c||(c="http://www.w3.org/1999/xhtml"),r!=null){for(d=0;d<r.length;d++)if((f=r[d])&&"setAttribute"in f==!!m&&(m?f.localName==m:f.nodeType==3)){e=f,r[d]=null;break}}if(e==null){if(m==null)return document.createTextNode(v);e=document.createElementNS(c,m,v.is&&v),a&&(b.__m&&b.__m(t,r),a=!1),r=null}if(m==null)p===v||a&&e.data==v||(e.data=v);else{if(r=r&&z.call(e.childNodes),!a&&r!=null)for(p={},d=0;d<e.attributes.length;d++)p[(f=e.attributes[d]).name]=f.value;for(d in p)if(f=p[d],d!="children"){if(d=="dangerouslySetInnerHTML")l=f;else if(!(d in v)){if(d=="value"&&"defaultValue"in v||d=="checked"&&"defaultChecked"in v)continue;W(e,d,null,f,c)}}for(d in v)f=v[d],d=="children"?u=f:d=="dangerouslySetInnerHTML"?h=f:d=="value"?y=f:d=="checked"?w=f:a&&typeof f!="function"||p[d]===f||W(e,d,f,p[d],c);if(h)a||l&&(h.__html==l.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(l&&(e.innerHTML=""),$e(t.type=="template"?e.content:e,V(u)?u:[u],t,n,i,m=="foreignObject"?"http://www.w3.org/1999/xhtml":c,r,o,r?r[0]:n.__k&&x(n,0),a,_),r!=null)for(d=r.length;d--;)te(r[d]);a||(d="value",m=="progress"&&y==null?e.removeAttribute("value"):y!=null&&(y!==e[d]||m=="progress"&&!y||m=="option"&&y!=p[d])&&W(e,d,y,p[d],c),d="checked",w!=null&&w!=e[d]&&W(e,d,w,p[d],c))}return e}function se(e,t,n){try{if(typeof e=="function"){var i=typeof e.__u=="function";i&&e.__u(),i&&t==null||(e.__u=e(t))}else e.current=t}catch(c){b.__e(c,n)}}function Re(e,t,n){var i,c;if(b.unmount&&b.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||se(i,null,t)),(i=e.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){b.__e(r,t)}i.base=i.__P=null}if(i=e.__k)for(c=0;c<i.length;c++)i[c]&&Re(i[c],t,n||typeof e.type!="function");n||te(e.__e),e.__c=e.__=e.__e=void 0}function Ue(e,t,n){return this.constructor(e,n)}function De(e,t,n){var i,c,r,o;t==document&&(t=document.documentElement),b.__&&b.__(e,t),c=(i=!1)?null:t.__k,r=[],o=[],ne(t,e=t.__k=Ae($,null,[e]),c||L,L,t.namespaceURI,c?null:t.firstChild?z.call(t.childNodes):null,r,c?c.__e:t.firstChild,i,o),Pe(r,e,o)}z=we.slice,b={__e:function(e,t,n,i){for(var c,r,o;t=t.__;)if((c=t.__c)&&!c.__)try{if((r=c.constructor)&&r.getDerivedStateFromError!=null&&(c.setState(r.getDerivedStateFromError(e)),o=c.__d),c.componentDidCatch!=null&&(c.componentDidCatch(e,i||{}),o=c.__d),o)return c.__E=c}catch(a){e=a}throw e}},ye=0,M.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=E({},this.state),typeof e=="function"&&(e=e(E({},n),this.props)),e&&E(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),ce(this))},M.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),ce(this))},M.prototype.render=$,T=[],be=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ge=function(e,t){return e.__v.__b-t.__v.__b},j.__r=0,ke=/(PointerCapture)$|Capture$/i,ee=0,Q=ae(!1),X=ae(!0);var We=0;function s(e,t,n,i,c,r){t||(t={});var o,a,_=t;if("ref"in _)for(a in _={},t)a=="ref"?o=t[a]:_[a]=t[a];var d={type:e,props:_,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--We,__i:-1,__u:0,__source:c,__self:r};if(typeof e=="function"&&(o=e.defaultProps))for(a in o)_[a]===void 0&&(_[a]=o[a]);return b.vnode&&b.vnode(d),d}var q,g,K,_e,J=0,Ne=[],k=b,de=k.__b,ue=k.__r,he=k.diffed,pe=k.__c,fe=k.unmount,ve=k.__;function re(e,t){k.__h&&k.__h(g,e,J||t),J=0;var n=g.__H||(g.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function S(e){return J=1,Oe(He,e)}function Oe(e,t,n){var i=re(q++,2);if(i.t=e,!i.__c&&(i.__=[He(void 0,t),function(a){var _=i.__N?i.__N[0]:i.__[0],d=i.t(_,a);_!==d&&(i.__N=[d,i.__[1]],i.__c.setState({}))}],i.__c=g,!g.__f)){var c=function(a,_,d){if(!i.__c.__H)return!0;var h=i.__c.__H.__.filter(function(u){return!!u.__c});if(h.every(function(u){return!u.__N}))return!r||r.call(this,a,_,d);var l=i.__c.props!==a;return h.forEach(function(u){if(u.__N){var f=u.__[0];u.__=u.__N,u.__N=void 0,f!==u.__[0]&&(l=!0)}}),r&&r.call(this,a,_,d)||l};g.__f=!0;var r=g.shouldComponentUpdate,o=g.componentWillUpdate;g.componentWillUpdate=function(a,_,d){if(this.__e){var h=r;r=void 0,c(a,_,d),r=h}o&&o.call(this,a,_,d)},g.shouldComponentUpdate=c}return i.__N||i.__}function R(e,t){var n=re(q++,3);!k.__s&&Te(n.__H,t)&&(n.__=e,n.u=t,g.__H.__h.push(n))}function I(e){return J=5,Me(function(){return{current:e}},[])}function Me(e,t){var n=re(q++,7);return Te(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Ie(){for(var e;e=Ne.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(B),e.__H.__h.forEach(Z),e.__H.__h=[]}catch(t){e.__H.__h=[],k.__e(t,e.__v)}}k.__b=function(e){g=null,de&&de(e)},k.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),ve&&ve(e,t)},k.__r=function(e){ue&&ue(e),q=0;var t=(g=e.__c).__H;t&&(K===g?(t.__h=[],g.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(B),t.__h.forEach(Z),t.__h=[],q=0)),K=g},k.diffed=function(e){he&&he(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Ne.push(t)!==1&&_e===k.requestAnimationFrame||((_e=k.requestAnimationFrame)||Be)(Ie)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),K=g=null},k.__c=function(e,t){t.some(function(n){try{n.__h.forEach(B),n.__h=n.__h.filter(function(i){return!i.__||Z(i)})}catch(i){t.some(function(c){c.__h&&(c.__h=[])}),t=[],k.__e(i,n.__v)}}),pe&&pe(e,t)},k.unmount=function(e){fe&&fe(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{B(i)}catch(c){t=c}}),n.__H=void 0,t&&k.__e(t,n.__v))};var me=typeof requestAnimationFrame=="function";function Be(e){var t,n=function(){clearTimeout(i),me&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,35);me&&(t=requestAnimationFrame(n))}function B(e){var t=g,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),g=t}function Z(e){var t=g;e.__c=e.__(),g=t}function Te(e,t){return!e||e.length!==t.length||t.some(function(n,i){return n!==e[i]})}function He(e,t){return typeof t=="function"?t(e):t}function je(e){const[t,n]=S("connecting"),i=I(null),c=I(1),r=I(new Map);R(()=>{const _=new WebSocket(e);return i.current=_,_.onopen=()=>{console.log("WebSocket connected"),n("connected")},_.onclose=()=>{console.log("WebSocket disconnected"),n("disconnected")},_.onerror=d=>{console.error("WebSocket error:",d),n("disconnected")},_.onmessage=d=>{try{const h=JSON.parse(d.data),l="type"in h?h.type:"response",u=r.current.get(l);u&&u.forEach(y=>y(h));const f=r.current.get("*");f&&f.forEach(y=>y(h))}catch(h){console.error("Failed to parse WebSocket message:",h)}},()=>{_.close()}},[e]);const o=(_,d)=>new Promise((h,l)=>{if(!i.current||i.current.readyState!==WebSocket.OPEN){l(new Error("WebSocket not connected"));return}const u=c.current++,f={id:u,type:_,payload:d},w=a("response",p=>{"id"in p&&p.id===u&&(w(),p.ok?h(p.payload):l(new Error(p.error||"Request failed")))});try{i.current.send(JSON.stringify(f))}catch(p){w(),l(p)}setTimeout(()=>{w(),l(new Error("Request timeout"))},3e4)}),a=(_,d)=>(r.current.has(_)||r.current.set(_,new Set),r.current.get(_).add(d),()=>{const h=r.current.get(_);h&&(h.delete(d),h.size===0&&r.current.delete(_))});return{status:t,sendRequest:o,subscribe:a}}function Je({onSimulationChange:e}){const[t,n]=S(""),[i,c]=S(!1),[r,o]=S(null),a=(l,u)=>{o({type:l,text:u}),setTimeout(()=>o(null),5e3)},_=async()=>{if(!t.trim()){a("error","Please enter a world path");return}c(!0);try{const u=await(await fetch("/api/sim/load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({world_path:t})})).json();u.success?(a("success",u.message),e==null||e()):a("error",u.message)}catch(l){a("error",`Failed to load simulation: ${l}`)}finally{c(!1)}},d=async()=>{c(!0);try{const u=await(await fetch("/api/sim/restart",{method:"POST"})).json();u.success?(a("success",u.message),e==null||e()):a("error",u.message)}catch(l){a("error",`Failed to restart simulation: ${l}`)}finally{c(!1)}},h=async()=>{c(!0);try{const u=await(await fetch("/api/sim/stop",{method:"POST"})).json();u.success?(a("success",u.message),e==null||e()):a("error",u.message)}catch(l){a("error",`Failed to stop simulation: ${l}`)}finally{c(!1)}};return s("div",{class:"simulation-control",children:[s("div",{class:"control-row",children:[s("input",{type:"text",value:t,onInput:l=>n(l.target.value),placeholder:"Path to world directory (e.g., worlds/my-world)",class:"world-path-input",disabled:i}),s("button",{onClick:_,disabled:i||!t.trim(),class:"control-btn primary",children:i?"Loading...":"Load World"})]}),s("div",{class:"control-row",children:[s("button",{onClick:d,disabled:i,class:"control-btn",children:"Restart"}),s("button",{onClick:h,disabled:i,class:"control-btn danger",children:"Stop Simulation"})]}),r&&s("div",{class:`message message-${r.type}`,children:r.text})]})}function ze({status:e,tickInfo:t,ws:n,hasErrors:i,onSimulationChange:c}){var v;const[r,o]=S(!1),[a,_]=S("stopped"),[d,h]=S(!0),[l,u]=S(null);R(()=>{i&&_("error")},[i]),R(()=>{n.status==="connected"&&n.sendRequest("status").then(m=>{h(m.warmup_complete??!0),m.warmup_complete?_(m.running?"running":"stopped"):_("warmup")}).catch(console.error)},[n.status]);const f=()=>{d||_("warmup"),n.sendRequest("step",{count:1}).then(m=>{h(m.warmup_complete??!0),_("stopped")}).catch(m=>{u(m.message||"Step failed"),_("error")})},y=()=>{d||_("warmup"),n.sendRequest("run").then(m=>{h(m.warmup_complete??!0),_("running")}).catch(m=>{u(m.message||"Run failed"),_("error")})},w=()=>{n.sendRequest("stop").then(()=>_("stopped")).catch(console.error)},p=()=>{switch(a){case"running":return"RUNNING";case"stopped":return"STOPPED";case"paused":return"PAUSED";case"warmup":return"WARMUP";case"error":return l||"ERROR"}};return s($,{children:[s("header",{class:"header",children:[s("div",{class:"header-left",children:[s("h1",{children:"Continuum Inspector"}),s("div",{class:`sim-status sim-status-${a}`,children:[s("span",{class:"sim-status-indicator"}),s("span",{class:"sim-status-label",children:p()})]})]}),s("div",{class:"header-controls",children:[s("button",{onClick:()=>o(!r),class:"control-btn",title:"Simulation lifecycle controls",children:[s("span",{class:"icon",children:"⚙"}),r?"Hide":"Sim"," Controls"]}),s("button",{onClick:f,disabled:a==="running",class:"control-btn",title:"Step one tick",children:[s("span",{class:"icon",children:"⏭"}),"Step"]}),s("button",{onClick:y,disabled:a==="running",class:"control-btn primary",title:"Run simulation",children:[s("span",{class:"icon",children:"▶"}),"Run"]}),s("button",{onClick:w,disabled:a==="stopped"||a==="error",class:"control-btn danger",title:"Stop simulation",children:[s("span",{class:"icon",children:"⏹"}),"Stop"]})]}),s("div",{class:"header-info",children:[t&&s("div",{class:"tick-info",children:[s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Tick"}),s("span",{class:"info-value",children:t.tick})]}),s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Era"}),s("span",{class:"info-value",children:t.era})]}),s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Time"}),s("span",{class:"info-value",children:[(v=t.sim_time)==null?void 0:v.toFixed(2),"s"]})]})]}),s("div",{class:`connection-status connection-${e}`,children:[s("span",{class:"connection-indicator"}),s("span",{class:"connection-label",children:e==="connected"?"Connected":e==="connecting"?"Connecting...":"Disconnected"})]})]})]}),r&&s("div",{class:"sim-control-panel",children:s(Je,{onSimulationChange:()=>{o(!1),c==null||c()}})})]})}function Ve({currentTab:e,onTabChange:t,onSelectItem:n,ws:i}){const[c,r]=S([]),[o,a]=S([]),[_,d]=S([]),[h,l]=S([]);R(()=>i.status!=="connected"?void 0:(i.sendRequest("signal.list").then(v=>{r(v.signals||[])}).catch(console.error),i.sendRequest("field.list").then(v=>{a(v.fields||[])}).catch(console.error),i.sendRequest("entity.list").then(v=>{d(v.entities||[])}).catch(console.error),i.subscribe("chronicle.event",v=>{"type"in v&&v.type==="chronicle.event"&&l(m=>[...m,{...v.payload,timestamp:new Date}].slice(-200))})),[i.status]);const u=p=>{i.sendRequest("signal.describe",{signal_id:p}).then(v=>{n({type:"signal",data:v})}).catch(console.error)},f=p=>{i.sendRequest("field.describe",{field_id:p}).then(v=>{n({type:"field",data:v})}).catch(console.error)},y=p=>{i.sendRequest("entity.describe",{entity_id:p}).then(v=>{n({type:"entity",data:v})}).catch(console.error)},w=p=>{n({type:"chronicle",data:p})};return s("div",{class:"tab-panel",children:[s("div",{class:"tabs",children:[s("button",{class:e==="signals"?"active":"",onClick:()=>t("signals"),children:["Signals (",c.length,")"]}),s("button",{class:e==="fields"?"active":"",onClick:()=>t("fields"),children:["Fields (",o.length,")"]}),s("button",{class:e==="entities"?"active":"",onClick:()=>t("entities"),children:["Entities (",_.length,")"]}),s("button",{class:e==="chronicles"?"active":"",onClick:()=>t("chronicles"),children:["Chronicles (",h.length,")"]})]}),s("div",{class:"tab-content",children:[e==="signals"&&s("div",{class:"item-list",children:c.map(p=>s("div",{class:"item",onClick:()=>u(p),children:p},p))}),e==="fields"&&s("div",{class:"item-list",children:o.map(p=>s("div",{class:"item",onClick:()=>f(p),children:p},p))}),e==="entities"&&s("div",{class:"item-list",children:_.map(p=>s("div",{class:"item",onClick:()=>y(p),children:p},p))}),e==="chronicles"&&s("div",{class:"item-list",children:h.length===0?s("div",{class:"empty",children:"No chronicle events yet..."}):[...h].reverse().map((p,v)=>s("div",{class:"item chronicle-item",onClick:()=>w(p),children:[s("div",{class:"chronicle-name",children:p.name}),s("div",{class:"chronicle-meta",children:["Tick ",p.tick," • Era: ",p.era," • ",p.sim_time.toFixed(2),"s"]})]},v))})]})]})}function Ge({selectedItem:e}){if(!e)return s("div",{class:"detail-panel",children:s("div",{class:"empty",children:"Select an item to view details"})});const{type:t,data:n}=e;return s("div",{class:"detail-panel",children:[s("div",{class:"detail-header",children:[s("h2",{children:n.title||n.id||n.name}),s("div",{class:"detail-type",children:t})]}),n.doc&&s("div",{class:"detail-doc",children:n.doc}),s("div",{class:"detail-content",children:[t==="signal"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),s("span",{class:"label",children:"Type:"}),s("span",{children:n.value_type}),n.unit&&s($,{children:[s("span",{class:"label",children:"Unit:"}),s("span",{children:n.unit})]}),n.stratum&&s($,{children:[s("span",{class:"label",children:"Stratum:"}),s("span",{children:n.stratum})]}),n.range&&s($,{children:[s("span",{class:"label",children:"Range:"}),s("span",{children:[n.range[0]," … ",n.range[1]]})]})]}),t==="field"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),s("span",{class:"label",children:"Topology:"}),s("span",{children:n.topology}),s("span",{class:"label",children:"Type:"}),s("span",{children:n.value_type}),n.unit&&s($,{children:[s("span",{class:"label",children:"Unit:"}),s("span",{children:n.unit})]}),n.range&&s($,{children:[s("span",{class:"label",children:"Range:"}),s("span",{children:[n.range[0]," … ",n.range[1]]})]})]}),t==="entity"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),n.count_bounds&&s($,{children:[s("span",{class:"label",children:"Count Bounds:"}),s("span",{children:[n.count_bounds[0]," … ",n.count_bounds[1]]})]})]}),t==="chronicle"&&s($,{children:[s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"Event:"}),s("span",{children:n.name}),s("span",{class:"label",children:"Tick:"}),s("span",{children:n.tick}),s("span",{class:"label",children:"Era:"}),s("span",{children:n.era}),s("span",{class:"label",children:"Sim Time:"}),s("span",{children:[n.sim_time.toFixed(2),"s"]})]}),n.fields&&n.fields.length>0&&s("div",{class:"detail-section",children:[s("h3",{children:"Fields"}),s("div",{class:"detail-grid",children:n.fields.map(([i,c])=>s($,{children:[s("span",{class:"label",children:[i,":"]}),s("span",{children:JSON.stringify(c)})]}))})]})]}),t==="assertion"&&s($,{children:s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"Signal:"}),s("span",{children:n.signal_id}),s("span",{class:"label",children:"Severity:"}),s("span",{class:`severity-${n.severity}`,children:n.severity.toUpperCase()}),s("span",{class:"label",children:"Message:"}),s("span",{children:n.message}),s("span",{class:"label",children:"Tick:"}),s("span",{children:n.tick}),s("span",{class:"label",children:"Era:"}),s("span",{children:n.era}),s("span",{class:"label",children:"Sim Time:"}),s("span",{children:[n.sim_time.toFixed(2),"s"]})]})})]})]})}function Ke({ws:e}){const[t,n]=S([]),i=I(null);return R(()=>e.status!=="connected"?void 0:e.subscribe("*",o=>{const a={timestamp:new Date,type:"type"in o&&o.type.includes("event")?"event":"error"in o?"error":"info",message:JSON.stringify(o,null,2)};n(_=>[..._,a].slice(-500))}),[e.status]),R(()=>{var r;(r=i.current)==null||r.scrollIntoView({behavior:"smooth"})},[t]),s("div",{class:"log-panel",children:[s("div",{class:"log-header",children:[s("h3",{children:"Log"}),s("button",{onClick:()=>{n([])},class:"small",children:"Clear"})]}),s("div",{class:"log-content",children:[t.map((r,o)=>s("div",{class:`log-entry log-${r.type}`,children:[s("span",{class:"log-time",children:["[",r.timestamp.toLocaleTimeString(),"]"]}),s("span",{class:"log-message",children:r.message})]},o)),s("div",{ref:i})]})]})}function Qe({ws:e,onSelectAssertion:t}){const[n,i]=S([]),[c,r]=S("all");R(()=>e.status!=="connected"?void 0:((()=>{e.sendRequest("assertion.failures").then(h=>{i(h.failures||[])}).catch(console.error)})(),e.subscribe("assertion",h=>{h.payload&&i(l=>[h.payload,...l].slice(0,200))})),[e.status]);const o=c==="all"?n:n.filter(_=>_.severity===c),a={warn:n.filter(_=>_.severity==="warn").length,error:n.filter(_=>_.severity==="error").length,fatal:n.filter(_=>_.severity==="fatal").length};return s("div",{class:"assertion-panel",children:[s("div",{class:"assertion-header",children:[s("h3",{children:"Assertions"}),s("div",{class:"assertion-filters",children:[s("button",{class:`filter-btn ${c==="all"?"active":""}`,onClick:()=>r("all"),children:["All (",n.length,")"]}),s("button",{class:`filter-btn severity-warn ${c==="warn"?"active":""}`,onClick:()=>r("warn"),children:["Warn (",a.warn,")"]}),s("button",{class:`filter-btn severity-error ${c==="error"?"active":""}`,onClick:()=>r("error"),children:["Error (",a.error,")"]}),s("button",{class:`filter-btn severity-fatal ${c==="fatal"?"active":""}`,onClick:()=>r("fatal"),children:["Fatal (",a.fatal,")"]})]})]}),s("div",{class:"assertion-content",children:o.length===0?s("div",{class:"empty",children:c==="all"?"No assertion failures":`No ${c} assertions`}):s("div",{class:"assertion-list",children:o.map((_,d)=>s("div",{class:`assertion-item severity-${_.severity}`,onClick:()=>t(_),children:[s("div",{class:"assertion-row",children:[s("span",{class:`assertion-badge severity-${_.severity}`,children:_.severity.toUpperCase()}),s("span",{class:"assertion-signal",children:_.signal_id}),s("span",{class:"assertion-tick",children:["Tick ",_.tick]})]}),s("div",{class:"assertion-message",children:_.message})]},d))})})]})}function Xe(){const e=je(`ws://${location.host}/ws`),[t,n]=S("signals"),[i,c]=S(null),[r,o]=S(null),[a,_]=S(0),d=()=>{window.location.reload()};R(()=>{if(e.status!=="connected")return;const l=e.subscribe("tick",u=>{"type"in u&&u.type==="tick"&&o(u.payload)});return e.sendRequest("status").then(u=>{u&&o(u)}).catch(console.error),l},[e.status]),R(()=>e.status!=="connected"?void 0:(e.sendRequest("assertion.failures").then(u=>{_((u.failures||[]).length)}).catch(console.error),e.subscribe("assertion",()=>{_(u=>u+1)})),[e.status]);const h=l=>{c({type:"assertion",data:l})};return s("div",{class:"app",children:[s(ze,{status:e.status,tickInfo:r,ws:e,hasErrors:a>0,onSimulationChange:d}),s("div",{class:"main-layout",children:[s(Ve,{currentTab:t,onTabChange:n,onSelectItem:c,ws:e}),s("div",{class:"center-panel",children:[s(Ge,{selectedItem:i,ws:e}),s(Ke,{ws:e})]}),s(Qe,{ws:e,onSelectAssertion:h})]})]})}De(s(Xe,{}),document.getElementById("app"));
