(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}})();var z,w,ye,T,ie,be,ge,ke,ee,Q,X,I={},we=[],xe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,V=Array.isArray;function A(e,t){for(var n in t)e[n]=t[n];return e}function te(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Fe(e,t,n){var i,l,r,a={};for(r in t)r=="key"?i=t[r]:r=="ref"?l=t[r]:a[r]=t[r];if(arguments.length>2&&(a.children=arguments.length>3?z.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(r in e.defaultProps)a[r]===void 0&&(a[r]=e.defaultProps[r]);return O(e,a,i,l,null)}function O(e,t,n,i,l){var r={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:l??++ye,__i:-1,__u:0};return l==null&&w.vnode!=null&&w.vnode(r),r}function $(e){return e.children}function D(e,t){this.props=e,this.context=t}function L(e,t){if(t==null)return e.__?L(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?L(e):null}function Se(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Se(e)}}function ce(e){(!e.__d&&(e.__d=!0)&&T.push(e)&&!J.__r++||ie!=w.debounceRendering)&&((ie=w.debounceRendering)||be)(J)}function J(){for(var e,t,n,i,l,r,a,_=1;T.length;)T.length>_&&T.sort(ge),e=T.shift(),_=T.length,e.__d&&(n=void 0,i=void 0,l=(i=(t=e).__v).__e,r=[],a=[],t.__P&&((n=A({},i)).__v=i.__v+1,w.vnode&&w.vnode(n),ne(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[l]:null,r,l??L(i),!!(32&i.__u),a),n.__v=i.__v,n.__.__k[n.__i]=n,Pe(r,n,a),i.__e=i.__=null,n.__e!=l&&Se(n)));J.__r=0}function Ce(e,t,n,i,l,r,a,_,d,o,h){var c,f,u,p,k,y,b,m=i&&i.__k||we,v=t.length;for(d=Le(n,t,m,d,v),c=0;c<v;c++)(u=n.__k[c])!=null&&(f=u.__i==-1?I:m[u.__i]||I,u.__i=c,y=ne(e,u,f,l,r,a,_,d,o,h),p=u.__e,u.ref&&f.ref!=u.ref&&(f.ref&&se(f.ref,null,u),h.push(u.ref,u.__c||p,u)),k==null&&p!=null&&(k=p),(b=!!(4&u.__u))||f.__k===u.__k?d=Ee(u,d,e,b):typeof u.type=="function"&&y!==void 0?d=y:p&&(d=p.nextSibling),u.__u&=-7);return n.__e=k,d}function Le(e,t,n,i,l){var r,a,_,d,o,h=n.length,c=h,f=0;for(e.__k=new Array(l),r=0;r<l;r++)(a=t[r])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[r]=O(null,a,null,null,null):V(a)?a=e.__k[r]=O($,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=e.__k[r]=O(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[r]=a,d=r+f,a.__=e,a.__b=e.__b+1,_=null,(o=a.__i=He(a,n,d,c))!=-1&&(c--,(_=n[o])&&(_.__u|=2)),_==null||_.__v==null?(o==-1&&(l>h?f--:l<h&&f++),typeof a.type!="function"&&(a.__u|=4)):o!=d&&(o==d-1?f--:o==d+1?f++:(o>d?f--:f++,a.__u|=4))):e.__k[r]=null;if(c)for(r=0;r<h;r++)(_=n[r])!=null&&!(2&_.__u)&&(_.__e==i&&(i=L(_)),Re(_,_));return i}function Ee(e,t,n,i){var l,r;if(typeof e.type=="function"){for(l=e.__k,r=0;l&&r<l.length;r++)l[r]&&(l[r].__=e,t=Ee(l[r],t,n,i));return t}e.__e!=t&&(i&&(t&&e.type&&!t.parentNode&&(t=L(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function He(e,t,n,i){var l,r,a,_=e.key,d=e.type,o=t[n],h=o!=null&&(2&o.__u)==0;if(o===null&&_==null||h&&_==o.key&&d==o.type)return n;if(i>(h?1:0)){for(l=n-1,r=n+1;l>=0||r<t.length;)if((o=t[a=l>=0?l--:r++])!=null&&!(2&o.__u)&&_==o.key&&d==o.type)return a}return-1}function oe(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||xe.test(t)?n:n+"px"}function W(e,t,n,i,l){var r,a;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof i=="string"&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||oe(e.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||oe(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")r=t!=(t=t.replace(ke,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?i?n.u=i.u:(n.u=ee,e.addEventListener(t,r?X:Q,r)):e.removeEventListener(t,r?X:Q,r);else{if(l=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function ae(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=ee++;else if(t.t<n.u)return;return n(w.event?w.event(t):t)}}}function ne(e,t,n,i,l,r,a,_,d,o){var h,c,f,u,p,k,y,b,m,v,g,P,x,le,U,H,G,R=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(d=!!(32&n.__u),r=[_=t.__e=n.__e]),(h=w.__b)&&h(t);e:if(typeof R=="function")try{if(b=t.props,m="prototype"in R&&R.prototype.render,v=(h=R.contextType)&&i[h.__c],g=h?v?v.props.value:h.__:i,n.__c?y=(c=t.__c=n.__c).__=c.__E:(m?t.__c=c=new R(b,g):(t.__c=c=new D(b,g),c.constructor=R,c.render=qe),v&&v.sub(c),c.state||(c.state={}),c.__n=i,f=c.__d=!0,c.__h=[],c._sb=[]),m&&c.__s==null&&(c.__s=c.state),m&&R.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=A({},c.__s)),A(c.__s,R.getDerivedStateFromProps(b,c.__s))),u=c.props,p=c.state,c.__v=t,f)m&&R.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),m&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(m&&R.getDerivedStateFromProps==null&&b!==u&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(b,g),t.__v==n.__v||!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(b,c.__s,g)===!1){for(t.__v!=n.__v&&(c.props=b,c.state=c.__s,c.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(F){F&&(F.__=t)}),P=0;P<c._sb.length;P++)c.__h.push(c._sb[P]);c._sb=[],c.__h.length&&a.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(b,c.__s,g),m&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(u,p,k)})}if(c.context=g,c.props=b,c.__P=e,c.__e=!1,x=w.__r,le=0,m){for(c.state=c.__s,c.__d=!1,x&&x(t),h=c.render(c.props,c.state,c.context),U=0;U<c._sb.length;U++)c.__h.push(c._sb[U]);c._sb=[]}else do c.__d=!1,x&&x(t),h=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++le<25);c.state=c.__s,c.getChildContext!=null&&(i=A(A({},i),c.getChildContext())),m&&!f&&c.getSnapshotBeforeUpdate!=null&&(k=c.getSnapshotBeforeUpdate(u,p)),H=h,h!=null&&h.type===$&&h.key==null&&(H=$e(h.props.children)),_=Ce(e,V(H)?H:[H],t,n,i,l,r,a,_,d,o),c.base=t.__e,t.__u&=-161,c.__h.length&&a.push(c),y&&(c.__E=c.__=null)}catch(F){if(t.__v=null,d||r!=null)if(F.then){for(t.__u|=d?160:128;_&&_.nodeType==8&&_.nextSibling;)_=_.nextSibling;r[r.indexOf(_)]=null,t.__e=_}else{for(G=r.length;G--;)te(r[G]);Y(t)}else t.__e=n.__e,t.__k=n.__k,F.then||Y(t);w.__e(F,t,n)}else r==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):_=t.__e=Ie(n.__e,t,n,i,l,r,a,d,o);return(h=w.diffed)&&h(t),128&t.__u?void 0:_}function Y(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Y)}function Pe(e,t,n){for(var i=0;i<n.length;i++)se(n[i],n[++i],n[++i]);w.__c&&w.__c(t,e),e.some(function(l){try{e=l.__h,l.__h=[],e.some(function(r){r.call(l)})}catch(r){w.__e(r,l.__v)}})}function $e(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:V(e)?e.map($e):A({},e)}function Ie(e,t,n,i,l,r,a,_,d){var o,h,c,f,u,p,k,y=n.props||I,b=t.props,m=t.type;if(m=="svg"?l="http://www.w3.org/2000/svg":m=="math"?l="http://www.w3.org/1998/Math/MathML":l||(l="http://www.w3.org/1999/xhtml"),r!=null){for(o=0;o<r.length;o++)if((u=r[o])&&"setAttribute"in u==!!m&&(m?u.localName==m:u.nodeType==3)){e=u,r[o]=null;break}}if(e==null){if(m==null)return document.createTextNode(b);e=document.createElementNS(l,m,b.is&&b),_&&(w.__m&&w.__m(t,r),_=!1),r=null}if(m==null)y===b||_&&e.data==b||(e.data=b);else{if(r=r&&z.call(e.childNodes),!_&&r!=null)for(y={},o=0;o<e.attributes.length;o++)y[(u=e.attributes[o]).name]=u.value;for(o in y)if(u=y[o],o!="children"){if(o=="dangerouslySetInnerHTML")c=u;else if(!(o in b)){if(o=="value"&&"defaultValue"in b||o=="checked"&&"defaultChecked"in b)continue;W(e,o,null,u,l)}}for(o in b)u=b[o],o=="children"?f=u:o=="dangerouslySetInnerHTML"?h=u:o=="value"?p=u:o=="checked"?k=u:_&&typeof u!="function"||y[o]===u||W(e,o,u,y[o],l);if(h)_||c&&(h.__html==c.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(c&&(e.innerHTML=""),Ce(t.type=="template"?e.content:e,V(f)?f:[f],t,n,i,m=="foreignObject"?"http://www.w3.org/1999/xhtml":l,r,a,r?r[0]:n.__k&&L(n,0),_,d),r!=null)for(o=r.length;o--;)te(r[o]);_||(o="value",m=="progress"&&p==null?e.removeAttribute("value"):p!=null&&(p!==e[o]||m=="progress"&&!p||m=="option"&&p!=y[o])&&W(e,o,p,y[o],l),o="checked",k!=null&&k!=e[o]&&W(e,o,k,y[o],l))}return e}function se(e,t,n){try{if(typeof e=="function"){var i=typeof e.__u=="function";i&&e.__u(),i&&t==null||(e.__u=e(t))}else e.current=t}catch(l){w.__e(l,n)}}function Re(e,t,n){var i,l;if(w.unmount&&w.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||se(i,null,t)),(i=e.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){w.__e(r,t)}i.base=i.__P=null}if(i=e.__k)for(l=0;l<i.length;l++)i[l]&&Re(i[l],t,n||typeof e.type!="function");n||te(e.__e),e.__c=e.__=e.__e=void 0}function qe(e,t,n){return this.constructor(e,n)}function Ue(e,t,n){var i,l,r,a;t==document&&(t=document.documentElement),w.__&&w.__(e,t),l=(i=!1)?null:t.__k,r=[],a=[],ne(t,e=t.__k=Fe($,null,[e]),l||I,I,t.namespaceURI,l?null:t.firstChild?z.call(t.childNodes):null,r,l?l.__e:t.firstChild,i,a),Pe(r,e,a)}z=we.slice,w={__e:function(e,t,n,i){for(var l,r,a;t=t.__;)if((l=t.__c)&&!l.__)try{if((r=l.constructor)&&r.getDerivedStateFromError!=null&&(l.setState(r.getDerivedStateFromError(e)),a=l.__d),l.componentDidCatch!=null&&(l.componentDidCatch(e,i||{}),a=l.__d),a)return l.__E=l}catch(_){e=_}throw e}},ye=0,D.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=A({},this.state),typeof e=="function"&&(e=e(A({},n),this.props)),e&&A(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),ce(this))},D.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),ce(this))},D.prototype.render=$,T=[],be=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ge=function(e,t){return e.__v.__b-t.__v.__b},J.__r=0,ke=/(PointerCapture)$|Capture$/i,ee=0,Q=ae(!1),X=ae(!0);var We=0;function s(e,t,n,i,l,r){t||(t={});var a,_,d=t;if("ref"in d)for(_ in d={},t)_=="ref"?a=t[_]:d[_]=t[_];var o={type:e,props:d,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--We,__i:-1,__u:0,__source:l,__self:r};if(typeof e=="function"&&(a=e.defaultProps))for(_ in a)d[_]===void 0&&(d[_]=a[_]);return w.vnode&&w.vnode(o),o}var q,C,K,_e,j=0,Ne=[],E=w,de=E.__b,ue=E.__r,pe=E.diffed,he=E.__c,fe=E.unmount,me=E.__;function re(e,t){E.__h&&E.__h(C,e,j||t),j=0;var n=C.__H||(C.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function S(e){return j=1,Oe(Te,e)}function Oe(e,t,n){var i=re(q++,2);if(i.t=e,!i.__c&&(i.__=[Te(void 0,t),function(_){var d=i.__N?i.__N[0]:i.__[0],o=i.t(d,_);d!==o&&(i.__N=[o,i.__[1]],i.__c.setState({}))}],i.__c=C,!C.__f)){var l=function(_,d,o){if(!i.__c.__H)return!0;var h=i.__c.__H.__.filter(function(f){return!!f.__c});if(h.every(function(f){return!f.__N}))return!r||r.call(this,_,d,o);var c=i.__c.props!==_;return h.forEach(function(f){if(f.__N){var u=f.__[0];f.__=f.__N,f.__N=void 0,u!==f.__[0]&&(c=!0)}}),r&&r.call(this,_,d,o)||c};C.__f=!0;var r=C.shouldComponentUpdate,a=C.componentWillUpdate;C.componentWillUpdate=function(_,d,o){if(this.__e){var h=r;r=void 0,l(_,d,o),r=h}a&&a.call(this,_,d,o)},C.shouldComponentUpdate=l}return i.__N||i.__}function N(e,t){var n=re(q++,3);!E.__s&&Ae(n.__H,t)&&(n.__=e,n.u=t,C.__H.__h.push(n))}function M(e){return j=5,De(function(){return{current:e}},[])}function De(e,t){var n=re(q++,7);return Ae(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Me(){for(var e;e=Ne.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(B),e.__H.__h.forEach(Z),e.__H.__h=[]}catch(t){e.__H.__h=[],E.__e(t,e.__v)}}E.__b=function(e){C=null,de&&de(e)},E.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),me&&me(e,t)},E.__r=function(e){ue&&ue(e),q=0;var t=(C=e.__c).__H;t&&(K===C?(t.__h=[],C.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(B),t.__h.forEach(Z),t.__h=[],q=0)),K=C},E.diffed=function(e){pe&&pe(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Ne.push(t)!==1&&_e===E.requestAnimationFrame||((_e=E.requestAnimationFrame)||Be)(Me)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),K=C=null},E.__c=function(e,t){t.some(function(n){try{n.__h.forEach(B),n.__h=n.__h.filter(function(i){return!i.__||Z(i)})}catch(i){t.some(function(l){l.__h&&(l.__h=[])}),t=[],E.__e(i,n.__v)}}),he&&he(e,t)},E.unmount=function(e){fe&&fe(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{B(i)}catch(l){t=l}}),n.__H=void 0,t&&E.__e(t,n.__v))};var ve=typeof requestAnimationFrame=="function";function Be(e){var t,n=function(){clearTimeout(i),ve&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,35);ve&&(t=requestAnimationFrame(n))}function B(e){var t=C,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),C=t}function Z(e){var t=C;e.__c=e.__(),C=t}function Ae(e,t){return!e||e.length!==t.length||t.some(function(n,i){return n!==e[i]})}function Te(e,t){return typeof t=="function"?t(e):t}function Je(e){const[t,n]=S("connecting"),i=M(null),l=M(1),r=M(new Map);N(()=>{const d=new WebSocket(e);return i.current=d,d.onopen=()=>{console.log("WebSocket connected"),n("connected")},d.onclose=()=>{console.log("WebSocket disconnected"),n("disconnected")},d.onerror=o=>{console.error("WebSocket error:",o),n("disconnected")},d.onmessage=o=>{try{const h=JSON.parse(o.data),c="type"in h?h.type:"response",f=r.current.get(c);f&&f.forEach(p=>p(h));const u=r.current.get("*");u&&u.forEach(p=>p(h))}catch(h){console.error("Failed to parse WebSocket message:",h)}},()=>{d.close()}},[e]);const a=(d,o)=>new Promise((h,c)=>{if(!i.current||i.current.readyState!==WebSocket.OPEN){c(new Error("WebSocket not connected"));return}const f=l.current++,u={id:f,type:d,payload:o},k=_("response",y=>{"id"in y&&y.id===f&&(k(),y.ok?h(y.payload):c(new Error(y.error||"Request failed")))});try{i.current.send(JSON.stringify(u))}catch(y){k(),c(y)}setTimeout(()=>{k(),c(new Error("Request timeout"))},3e4)}),_=(d,o)=>(r.current.has(d)||r.current.set(d,new Set),r.current.get(d).add(o),()=>{const h=r.current.get(d);h&&(h.delete(o),h.size===0&&r.current.delete(d))});return{status:t,sendRequest:a,subscribe:_}}function je({onSimulationChange:e}){const[t,n]=S(""),[i,l]=S(""),[r,a]=S(!1),[_,d]=S(null),o=(u,p)=>{d({type:u,text:p}),setTimeout(()=>d(null),5e3)},h=async()=>{if(!t.trim()){o("error","Please enter a world path");return}a(!0);try{const u={world_path:t};i.trim()&&(u.scenario=i.trim());const k=await(await fetch("/api/sim/load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).json();k.success?(o("success",k.message),e==null||e()):o("error",k.message)}catch(u){o("error",`Failed to load simulation: ${u}`)}finally{a(!1)}},c=async()=>{a(!0);try{const p=await(await fetch("/api/sim/restart",{method:"POST"})).json();p.success?(o("success",p.message),e==null||e()):o("error",p.message)}catch(u){o("error",`Failed to restart simulation: ${u}`)}finally{a(!1)}},f=async()=>{a(!0);try{const p=await(await fetch("/api/sim/stop",{method:"POST"})).json();p.success?(o("success",p.message),e==null||e()):o("error",p.message)}catch(u){o("error",`Failed to stop simulation: ${u}`)}finally{a(!1)}};return s("div",{class:"simulation-control",children:[s("div",{class:"control-row",children:[s("input",{type:"text",value:t,onInput:u=>n(u.target.value),placeholder:"Path to world directory (e.g., examples/terra)",class:"world-path-input",disabled:r}),s("input",{type:"text",value:i,onInput:u=>l(u.target.value),placeholder:"Scenario (optional, e.g., default)",class:"scenario-input",disabled:r}),s("button",{onClick:h,disabled:r||!t.trim(),class:"control-btn primary",children:r?"Loading...":"Load World"})]}),s("div",{class:"control-row",children:[s("button",{onClick:c,disabled:r,class:"control-btn",children:"Restart"}),s("button",{onClick:f,disabled:r,class:"control-btn danger",children:"Stop Simulation"})]}),_&&s("div",{class:`message message-${_.type}`,children:_.text})]})}function ze({status:e,tickInfo:t,ws:n,hasErrors:i,onSimulationChange:l}){var b;const[r,a]=S(!1),[_,d]=S("stopped"),[o,h]=S(!0),[c,f]=S(null);N(()=>{i&&d("error")},[i]),N(()=>{n.status==="connected"&&n.sendRequest("status").then(m=>{h(m.warmup_complete??!0),m.warmup_complete?d(m.running?"running":"stopped"):d("warmup")}).catch(console.error)},[n.status]);const u=()=>{o||d("warmup"),n.sendRequest("step",{count:1}).then(m=>{h(m.warmup_complete??!0),d("stopped")}).catch(m=>{f(m.message||"Step failed"),d("error")})},p=()=>{o||d("warmup"),n.sendRequest("run").then(m=>{h(m.warmup_complete??!0),d("running")}).catch(m=>{f(m.message||"Run failed"),d("error")})},k=()=>{n.sendRequest("stop").then(()=>d("stopped")).catch(console.error)},y=()=>{switch(_){case"running":return"RUNNING";case"stopped":return"STOPPED";case"paused":return"PAUSED";case"warmup":return"WARMUP";case"error":return c||"ERROR"}};return s($,{children:[s("header",{class:"header",children:[s("div",{class:"header-left",children:[s("h1",{children:"Continuum Inspector"}),s("div",{class:`sim-status sim-status-${_}`,children:[s("span",{class:"sim-status-indicator"}),s("span",{class:"sim-status-label",children:y()})]})]}),s("div",{class:"header-controls",children:[s("button",{onClick:()=>a(!r),class:"control-btn",title:"Simulation lifecycle controls",children:[s("span",{class:"icon",children:"⚙"}),r?"Hide":"Sim"," Controls"]}),s("button",{onClick:u,disabled:_==="running",class:"control-btn",title:"Step one tick",children:[s("span",{class:"icon",children:"⏭"}),"Step"]}),s("button",{onClick:p,disabled:_==="running",class:"control-btn primary",title:"Run simulation",children:[s("span",{class:"icon",children:"▶"}),"Run"]}),s("button",{onClick:k,disabled:_==="stopped"||_==="error",class:"control-btn danger",title:"Stop simulation",children:[s("span",{class:"icon",children:"⏹"}),"Stop"]})]}),s("div",{class:"header-info",children:[t&&s("div",{class:"tick-info",children:[s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Tick"}),s("span",{class:"info-value",children:t.tick})]}),s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Era"}),s("span",{class:"info-value",children:t.era})]}),s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Time"}),s("span",{class:"info-value",children:[(b=t.sim_time)==null?void 0:b.toFixed(2),"s"]})]})]}),s("div",{class:`connection-status connection-${e}`,children:[s("span",{class:"connection-indicator"}),s("span",{class:"connection-label",children:e==="connected"?"Connected":e==="connecting"?"Connecting...":"Disconnected"})]})]})]}),r&&s("div",{class:"sim-control-panel",children:s(je,{onSimulationChange:()=>{a(!1),l==null||l()}})})]})}function Ve({currentTab:e,onTabChange:t,onSelectItem:n,onEmitImpulse:i,ws:l}){const[r,a]=S([]),[_,d]=S([]),[o,h]=S([]),[c,f]=S([]),[u,p]=S([]);N(()=>l.status!=="connected"?void 0:(l.sendRequest("signal.list").then(g=>{a(Array.isArray(g)?g.map(P=>P.id):[])}).catch(console.error),l.sendRequest("field.list").then(g=>{d(Array.isArray(g)?g.map(P=>P.id):[])}).catch(console.error),l.sendRequest("entity.list").then(g=>{h(Array.isArray(g)?g.map(P=>P.id):[])}).catch(console.error),l.sendRequest("impulse.list").then(g=>{p(g||[])}).catch(console.error),l.subscribe("chronicle.event",g=>{"type"in g&&g.type==="chronicle.event"&&f(P=>[...P,{...g.payload,timestamp:new Date}].slice(-200))})),[l.status]);const k=v=>{l.sendRequest("signal.describe",{signal_id:v}).then(g=>{n({type:"signal",data:g})}).catch(console.error)},y=v=>{l.sendRequest("field.describe",{field_id:v}).then(g=>{n({type:"field",data:g})}).catch(console.error)},b=v=>{l.sendRequest("entity.describe",{entity_id:v}).then(g=>{n({type:"entity",data:g})}).catch(console.error)},m=v=>{n({type:"chronicle",data:v})};return s("div",{class:"tab-panel",children:[s("div",{class:"tabs",children:[s("button",{class:e==="signals"?"active":"",onClick:()=>t("signals"),children:["Signals (",r.length,")"]}),s("button",{class:e==="fields"?"active":"",onClick:()=>t("fields"),children:["Fields (",_.length,")"]}),s("button",{class:e==="entities"?"active":"",onClick:()=>t("entities"),children:["Entities (",o.length,")"]}),s("button",{class:e==="chronicles"?"active":"",onClick:()=>t("chronicles"),children:["Chronicles (",c.length,")"]}),s("button",{class:e==="impulses"?"active":"",onClick:()=>t("impulses"),children:["Impulses (",u.length,")"]})]}),s("div",{class:"tab-content",children:[e==="signals"&&s("div",{class:"item-list",children:r.map(v=>s("div",{class:"item",onClick:()=>k(v),children:v},v))}),e==="fields"&&s("div",{class:"item-list",children:_.map(v=>s("div",{class:"item",onClick:()=>y(v),children:v},v))}),e==="entities"&&s("div",{class:"item-list",children:o.map(v=>s("div",{class:"item",onClick:()=>b(v),children:v},v))}),e==="chronicles"&&s("div",{class:"item-list",children:c.length===0?s("div",{class:"empty",children:"No chronicle events yet..."}):[...c].reverse().map((v,g)=>s("div",{class:"item chronicle-item",onClick:()=>m(v),children:[s("div",{class:"chronicle-name",children:v.name}),s("div",{class:"chronicle-meta",children:["Tick ",v.tick," • Era: ",v.era," • ",v.sim_time.toFixed(2),"s",e==="impulses"&&s("div",{class:"item-list",children:[s("button",{class:"primary emit-btn",onClick:i,children:"Emit Impulse..."}),u.map(P=>s("div",{class:"item",onClick:()=>n({type:"impulse",data:P}),children:P.path},P.path))]})]})]},g))})]})]})}function Ge({selectedItem:e}){if(!e)return s("div",{class:"detail-panel",children:s("div",{class:"empty",children:"Select an item to view details"})});const{type:t,data:n}=e;return s("div",{class:"detail-panel",children:[s("div",{class:"detail-header",children:[s("h2",{children:n.title||n.id||n.name}),s("div",{class:"detail-type",children:t})]}),n.doc&&s("div",{class:"detail-doc",children:n.doc}),s("div",{class:"detail-content",children:[t==="signal"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),s("span",{class:"label",children:"Type:"}),s("span",{children:n.value_type}),n.unit&&s($,{children:[s("span",{class:"label",children:"Unit:"}),s("span",{children:n.unit})]}),n.stratum&&s($,{children:[s("span",{class:"label",children:"Stratum:"}),s("span",{children:n.stratum})]}),n.range&&s($,{children:[s("span",{class:"label",children:"Range:"}),s("span",{children:[n.range[0]," … ",n.range[1]]})]})]}),t==="field"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),s("span",{class:"label",children:"Topology:"}),s("span",{children:n.topology}),s("span",{class:"label",children:"Type:"}),s("span",{children:n.value_type}),n.unit&&s($,{children:[s("span",{class:"label",children:"Unit:"}),s("span",{children:n.unit})]}),n.range&&s($,{children:[s("span",{class:"label",children:"Range:"}),s("span",{children:[n.range[0]," … ",n.range[1]]})]})]}),t==="entity"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),n.count_bounds&&s($,{children:[s("span",{class:"label",children:"Count Bounds:"}),s("span",{children:[n.count_bounds[0]," … ",n.count_bounds[1]]})]})]}),t==="chronicle"&&s($,{children:[s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"Event:"}),s("span",{children:n.name}),s("span",{class:"label",children:"Tick:"}),s("span",{children:n.tick}),s("span",{class:"label",children:"Era:"}),s("span",{children:n.era}),s("span",{class:"label",children:"Sim Time:"}),s("span",{children:[n.sim_time.toFixed(2),"s"]})]}),n.fields&&n.fields.length>0&&s("div",{class:"detail-section",children:[s("h3",{children:"Fields"}),s("div",{class:"detail-grid",children:n.fields.map(([i,l])=>s($,{children:[s("span",{class:"label",children:[i,":"]}),s("span",{children:JSON.stringify(l)})]}))})]})]}),t==="assertion"&&s($,{children:s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"Signal:"}),s("span",{children:n.signal_id}),s("span",{class:"label",children:"Severity:"}),s("span",{class:`severity-${n.severity}`,children:n.severity.toUpperCase()}),s("span",{class:"label",children:"Message:"}),s("span",{children:n.message}),s("span",{class:"label",children:"Tick:"}),s("span",{children:n.tick}),s("span",{class:"label",children:"Era:"}),s("span",{children:n.era}),s("span",{class:"label",children:"Sim Time:"}),s("span",{children:[n.sim_time.toFixed(2),"s"]})]})}),t==="impulse"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"Path:"}),s("span",{children:n.path}),s("span",{class:"label",children:"Payload Type:"}),s("span",{children:n.payload_type||"None"})]})]})]})}function Ke({ws:e}){const[t,n]=S([]),i=M(null);return N(()=>e.status!=="connected"?void 0:e.subscribe("*",a=>{const _={timestamp:new Date,type:"type"in a&&a.type.includes("event")?"event":"error"in a?"error":"info",message:JSON.stringify(a,null,2)};n(d=>[...d,_].slice(-500))}),[e.status]),N(()=>{var r;(r=i.current)==null||r.scrollIntoView({behavior:"smooth"})},[t]),s("div",{class:"log-panel",children:[s("div",{class:"log-header",children:[s("h3",{children:"Log"}),s("button",{onClick:()=>{n([])},class:"small",children:"Clear"})]}),s("div",{class:"log-content",children:[t.map((r,a)=>s("div",{class:`log-entry log-${r.type}`,children:[s("span",{class:"log-time",children:["[",r.timestamp.toLocaleTimeString(),"]"]}),s("span",{class:"log-message",children:r.message})]},a)),s("div",{ref:i})]})]})}function Qe({ws:e,onSelectAssertion:t}){const[n,i]=S([]),[l,r]=S("all");N(()=>e.status!=="connected"?void 0:((()=>{e.sendRequest("assertion.failures").then(h=>{i(h.failures||[])}).catch(console.error)})(),e.subscribe("assertion",h=>{h.payload&&i(c=>[h.payload,...c].slice(0,200))})),[e.status]);const a=l==="all"?n:n.filter(d=>d.severity===l),_={warn:n.filter(d=>d.severity==="warn").length,error:n.filter(d=>d.severity==="error").length,fatal:n.filter(d=>d.severity==="fatal").length};return s("div",{class:"assertion-panel",children:[s("div",{class:"assertion-header",children:[s("h3",{children:"Assertions"}),s("div",{class:"assertion-filters",children:[s("button",{class:`filter-btn ${l==="all"?"active":""}`,onClick:()=>r("all"),children:["All (",n.length,")"]}),s("button",{class:`filter-btn severity-warn ${l==="warn"?"active":""}`,onClick:()=>r("warn"),children:["Warn (",_.warn,")"]}),s("button",{class:`filter-btn severity-error ${l==="error"?"active":""}`,onClick:()=>r("error"),children:["Error (",_.error,")"]}),s("button",{class:`filter-btn severity-fatal ${l==="fatal"?"active":""}`,onClick:()=>r("fatal"),children:["Fatal (",_.fatal,")"]})]})]}),s("div",{class:"assertion-content",children:a.length===0?s("div",{class:"empty",children:l==="all"?"No assertion failures":`No ${l} assertions`}):s("div",{class:"assertion-list",children:a.map((d,o)=>s("div",{class:`assertion-item severity-${d.severity}`,onClick:()=>t(d),children:[s("div",{class:"assertion-row",children:[s("span",{class:`assertion-badge severity-${d.severity}`,children:d.severity.toUpperCase()}),s("span",{class:"assertion-signal",children:d.signal_id}),s("span",{class:"assertion-tick",children:["Tick ",d.tick]})]}),s("div",{class:"assertion-message",children:d.message})]},o))})})]})}function Xe({isOpen:e,onClose:t,ws:n}){var f,u;const[i,l]=S([]),[r,a]=S(null),[_,d]=S(""),[o,h]=S(null);N(()=>{e&&n.status==="connected"&&n.sendRequest("impulse.list").then(p=>{l(p||[])}).catch(console.error)},[e,n.status]);const c=async()=>{var k,y;if(!r)return;let p;try{if((k=r.payload_type)!=null&&k.toLowerCase().includes("scalar")){if(p=parseFloat(_),isNaN(p))throw new Error("Invalid scalar value")}else(y=r.payload_type)!=null&&y.toLowerCase().includes("bool")?p=_.toLowerCase()==="true":_.trim().startsWith("{")||_.trim().startsWith("[")?p=JSON.parse(_):p=_;const b=await n.sendRequest("impulse.emit",{path:r.path,payload:p});h({type:"success",message:"Impulse emitted successfully"}),setTimeout(()=>{h(null),t()},1500)}catch(b){h({type:"error",message:b.message})}};return e?s("div",{class:"modal-overlay",onClick:t,children:s("div",{class:"modal-content",onClick:p=>p.stopPropagation(),children:[s("div",{class:"modal-header",children:[s("h2",{children:"Emit Impulse"}),s("button",{class:"close-btn",onClick:t,children:"×"})]}),s("div",{class:"modal-body",children:[s("div",{class:"form-group",children:[s("label",{children:"Select Impulse"}),s("select",{value:(r==null?void 0:r.path)||"",onChange:p=>{const k=i.find(y=>y.path===p.target.value);a(k||null),h(null)},children:[s("option",{value:"",children:"-- Choose an impulse --"}),i.map(p=>s("option",{value:p.path,children:p.path},p.path))]})]}),r&&s("div",{class:"impulse-details",children:[r.doc&&s("p",{class:"doc-text",children:r.doc}),s("div",{class:"form-group",children:[s("label",{children:["Payload (",r.payload_type||"Unknown Type",")"]}),(f=r.payload_type)!=null&&f.toLowerCase().includes("scalar")?s("input",{type:"number",step:"any",value:_,onInput:p=>d(p.target.value),placeholder:"Enter numeric value"}):(u=r.payload_type)!=null&&u.toLowerCase().includes("bool")?s("select",{value:_,onChange:p=>d(p.target.value),children:[s("option",{value:"true",children:"True"}),s("option",{value:"false",children:"False"})]}):s("textarea",{value:_,onInput:p=>d(p.target.value),placeholder:"Enter JSON or string payload"})]})]}),o&&s("div",{class:`status-message ${o.type}`,children:o.message})]}),s("div",{class:"modal-footer",children:[s("button",{class:"secondary",onClick:t,children:"Cancel"}),s("button",{class:"primary",onClick:c,disabled:!r||!_,children:"Emit"})]})]})}):null}function Ye(){const e=Je(`ws://${location.host}/ws`),[t,n]=S("signals"),[i,l]=S(null),[r,a]=S(null),[_,d]=S(0),[o,h]=S(!1),c=()=>{window.location.reload()};N(()=>{if(e.status!=="connected")return;const u=e.subscribe("tick",p=>{"type"in p&&p.type==="tick"&&a(p.payload)});return e.sendRequest("status").then(p=>{p&&a(p)}).catch(console.error),u},[e.status]),N(()=>e.status!=="connected"?void 0:(e.sendRequest("assertion.failures").then(p=>{d((p.failures||[]).length)}).catch(console.error),e.subscribe("assertion",()=>{d(p=>p+1)})),[e.status]);const f=u=>{l({type:"assertion",data:u})};return s("div",{class:"app",children:[s(ze,{status:e.status,tickInfo:r,ws:e,hasErrors:_>0,onSimulationChange:c}),s("div",{class:"main-layout",children:[s(Ve,{currentTab:t,onTabChange:n,onSelectItem:l,onEmitImpulse:()=>h(!0),ws:e}),s("div",{class:"center-panel",children:[s(Ge,{selectedItem:i,ws:e}),s(Ke,{ws:e})]}),s(Qe,{ws:e,onSelectAssertion:f})]}),s(Xe,{isOpen:o,onClose:()=>h(!1),ws:e})]})}Ue(s(Ye,{}),document.getElementById("app"));
