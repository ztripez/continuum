(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}})();var V,C,ye,L,ie,be,ge,ke,te,X,Y,W={},we=[],Ae=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,G=Array.isArray;function T(e,t){for(var n in t)e[n]=t[n];return e}function ne(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Fe(e,t,n){var i,l,r,a={};for(r in t)r=="key"?i=t[r]:r=="ref"?l=t[r]:a[r]=t[r];if(arguments.length>2&&(a.children=arguments.length>3?V.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(r in e.defaultProps)a[r]===void 0&&(a[r]=e.defaultProps[r]);return M(e,a,i,l,null)}function M(e,t,n,i,l){var r={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:l??++ye,__i:-1,__u:0};return l==null&&C.vnode!=null&&C.vnode(r),r}function $(e){return e.children}function I(e,t){this.props=e,this.context=t}function q(e,t){if(t==null)return e.__?q(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?q(e):null}function Se(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Se(e)}}function ce(e){(!e.__d&&(e.__d=!0)&&L.push(e)&&!j.__r++||ie!=C.debounceRendering)&&((ie=C.debounceRendering)||be)(j)}function j(){for(var e,t,n,i,l,r,a,d=1;L.length;)L.length>d&&L.sort(ge),e=L.shift(),d=L.length,e.__d&&(n=void 0,i=void 0,l=(i=(t=e).__v).__e,r=[],a=[],t.__P&&((n=T({},i)).__v=i.__v+1,C.vnode&&C.vnode(n),se(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[l]:null,r,l??q(i),!!(32&i.__u),a),n.__v=i.__v,n.__.__k[n.__i]=n,Pe(r,n,a),i.__e=i.__=null,n.__e!=l&&Se(n)));j.__r=0}function Ce(e,t,n,i,l,r,a,d,_,o,h){var c,f,u,p,k,v,b,g=i&&i.__k||we,m=t.length;for(_=Le(n,t,g,_,m),c=0;c<m;c++)(u=n.__k[c])!=null&&(f=u.__i==-1?W:g[u.__i]||W,u.__i=c,v=se(e,u,f,l,r,a,d,_,o,h),p=u.__e,u.ref&&f.ref!=u.ref&&(f.ref&&re(f.ref,null,u),h.push(u.ref,u.__c||p,u)),k==null&&p!=null&&(k=p),(b=!!(4&u.__u))||f.__k===u.__k?_=Re(u,_,e,b):typeof u.type=="function"&&v!==void 0?_=v:p&&(_=p.nextSibling),u.__u&=-7);return n.__e=k,_}function Le(e,t,n,i,l){var r,a,d,_,o,h=n.length,c=h,f=0;for(e.__k=new Array(l),r=0;r<l;r++)(a=t[r])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[r]=M(null,a,null,null,null):G(a)?a=e.__k[r]=M($,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=e.__k[r]=M(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[r]=a,_=r+f,a.__=e,a.__b=e.__b+1,d=null,(o=a.__i=He(a,n,_,c))!=-1&&(c--,(d=n[o])&&(d.__u|=2)),d==null||d.__v==null?(o==-1&&(l>h?f--:l<h&&f++),typeof a.type!="function"&&(a.__u|=4)):o!=_&&(o==_-1?f--:o==_+1?f++:(o>_?f--:f++,a.__u|=4))):e.__k[r]=null;if(c)for(r=0;r<h;r++)(d=n[r])!=null&&!(2&d.__u)&&(d.__e==i&&(i=q(d)),$e(d,d));return i}function Re(e,t,n,i){var l,r;if(typeof e.type=="function"){for(l=e.__k,r=0;l&&r<l.length;r++)l[r]&&(l[r].__=e,t=Re(l[r],t,n,i));return t}e.__e!=t&&(i&&(t&&e.type&&!t.parentNode&&(t=q(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function He(e,t,n,i){var l,r,a,d=e.key,_=e.type,o=t[n],h=o!=null&&(2&o.__u)==0;if(o===null&&d==null||h&&d==o.key&&_==o.type)return n;if(i>(h?1:0)){for(l=n-1,r=n+1;l>=0||r<t.length;)if((o=t[a=l>=0?l--:r++])!=null&&!(2&o.__u)&&d==o.key&&_==o.type)return a}return-1}function oe(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||Ae.test(t)?n:n+"px"}function D(e,t,n,i,l){var r,a;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof i=="string"&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||oe(e.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||oe(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")r=t!=(t=t.replace(ke,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?i?n.u=i.u:(n.u=te,e.addEventListener(t,r?Y:X,r)):e.removeEventListener(t,r?Y:X,r);else{if(l=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function ae(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=te++;else if(t.t<n.u)return;return n(C.event?C.event(t):t)}}}function se(e,t,n,i,l,r,a,d,_,o){var h,c,f,u,p,k,v,b,g,m,y,E,A,U,w,F,K,x=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(_=!!(32&n.__u),r=[d=t.__e=n.__e]),(h=C.__b)&&h(t);e:if(typeof x=="function")try{if(b=t.props,g="prototype"in x&&x.prototype.render,m=(h=x.contextType)&&i[h.__c],y=h?m?m.props.value:h.__:i,n.__c?v=(c=t.__c=n.__c).__=c.__E:(g?t.__c=c=new x(b,y):(t.__c=c=new I(b,y),c.constructor=x,c.render=Ue),m&&m.sub(c),c.state||(c.state={}),c.__n=i,f=c.__d=!0,c.__h=[],c._sb=[]),g&&c.__s==null&&(c.__s=c.state),g&&x.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=T({},c.__s)),T(c.__s,x.getDerivedStateFromProps(b,c.__s))),u=c.props,p=c.state,c.__v=t,f)g&&x.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),g&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(g&&x.getDerivedStateFromProps==null&&b!==u&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(b,y),t.__v==n.__v||!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(b,c.__s,y)===!1){for(t.__v!=n.__v&&(c.props=b,c.state=c.__s,c.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(H){H&&(H.__=t)}),E=0;E<c._sb.length;E++)c.__h.push(c._sb[E]);c._sb=[],c.__h.length&&a.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(b,c.__s,y),g&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(u,p,k)})}if(c.context=y,c.props=b,c.__P=e,c.__e=!1,A=C.__r,U=0,g){for(c.state=c.__s,c.__d=!1,A&&A(t),h=c.render(c.props,c.state,c.context),w=0;w<c._sb.length;w++)c.__h.push(c._sb[w]);c._sb=[]}else do c.__d=!1,A&&A(t),h=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++U<25);c.state=c.__s,c.getChildContext!=null&&(i=T(T({},i),c.getChildContext())),g&&!f&&c.getSnapshotBeforeUpdate!=null&&(k=c.getSnapshotBeforeUpdate(u,p)),F=h,h!=null&&h.type===$&&h.key==null&&(F=Ee(h.props.children)),d=Ce(e,G(F)?F:[F],t,n,i,l,r,a,d,_,o),c.base=t.__e,t.__u&=-161,c.__h.length&&a.push(c),v&&(c.__E=c.__=null)}catch(H){if(t.__v=null,_||r!=null)if(H.then){for(t.__u|=_?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;r[r.indexOf(d)]=null,t.__e=d}else{for(K=r.length;K--;)ne(r[K]);Z(t)}else t.__e=n.__e,t.__k=n.__k,H.then||Z(t);C.__e(H,t,n)}else r==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):d=t.__e=qe(n.__e,t,n,i,l,r,a,_,o);return(h=C.diffed)&&h(t),128&t.__u?void 0:d}function Z(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Z)}function Pe(e,t,n){for(var i=0;i<n.length;i++)re(n[i],n[++i],n[++i]);C.__c&&C.__c(t,e),e.some(function(l){try{e=l.__h,l.__h=[],e.some(function(r){r.call(l)})}catch(r){C.__e(r,l.__v)}})}function Ee(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:G(e)?e.map(Ee):T({},e)}function qe(e,t,n,i,l,r,a,d,_){var o,h,c,f,u,p,k,v=n.props||W,b=t.props,g=t.type;if(g=="svg"?l="http://www.w3.org/2000/svg":g=="math"?l="http://www.w3.org/1998/Math/MathML":l||(l="http://www.w3.org/1999/xhtml"),r!=null){for(o=0;o<r.length;o++)if((u=r[o])&&"setAttribute"in u==!!g&&(g?u.localName==g:u.nodeType==3)){e=u,r[o]=null;break}}if(e==null){if(g==null)return document.createTextNode(b);e=document.createElementNS(l,g,b.is&&b),d&&(C.__m&&C.__m(t,r),d=!1),r=null}if(g==null)v===b||d&&e.data==b||(e.data=b);else{if(r=r&&V.call(e.childNodes),!d&&r!=null)for(v={},o=0;o<e.attributes.length;o++)v[(u=e.attributes[o]).name]=u.value;for(o in v)if(u=v[o],o!="children"){if(o=="dangerouslySetInnerHTML")c=u;else if(!(o in b)){if(o=="value"&&"defaultValue"in b||o=="checked"&&"defaultChecked"in b)continue;D(e,o,null,u,l)}}for(o in b)u=b[o],o=="children"?f=u:o=="dangerouslySetInnerHTML"?h=u:o=="value"?p=u:o=="checked"?k=u:d&&typeof u!="function"||v[o]===u||D(e,o,u,v[o],l);if(h)d||c&&(h.__html==c.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(c&&(e.innerHTML=""),Ce(t.type=="template"?e.content:e,G(f)?f:[f],t,n,i,g=="foreignObject"?"http://www.w3.org/1999/xhtml":l,r,a,r?r[0]:n.__k&&q(n,0),d,_),r!=null)for(o=r.length;o--;)ne(r[o]);d||(o="value",g=="progress"&&p==null?e.removeAttribute("value"):p!=null&&(p!==e[o]||g=="progress"&&!p||g=="option"&&p!=v[o])&&D(e,o,p,v[o],l),o="checked",k!=null&&k!=e[o]&&D(e,o,k,v[o],l))}return e}function re(e,t,n){try{if(typeof e=="function"){var i=typeof e.__u=="function";i&&e.__u(),i&&t==null||(e.__u=e(t))}else e.current=t}catch(l){C.__e(l,n)}}function $e(e,t,n){var i,l;if(C.unmount&&C.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||re(i,null,t)),(i=e.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){C.__e(r,t)}i.base=i.__P=null}if(i=e.__k)for(l=0;l<i.length;l++)i[l]&&$e(i[l],t,n||typeof e.type!="function");n||ne(e.__e),e.__c=e.__=e.__e=void 0}function Ue(e,t,n){return this.constructor(e,n)}function We(e,t,n){var i,l,r,a;t==document&&(t=document.documentElement),C.__&&C.__(e,t),l=(i=!1)?null:t.__k,r=[],a=[],se(t,e=t.__k=Fe($,null,[e]),l||W,W,t.namespaceURI,l?null:t.firstChild?V.call(t.childNodes):null,r,l?l.__e:t.firstChild,i,a),Pe(r,e,a)}V=we.slice,C={__e:function(e,t,n,i){for(var l,r,a;t=t.__;)if((l=t.__c)&&!l.__)try{if((r=l.constructor)&&r.getDerivedStateFromError!=null&&(l.setState(r.getDerivedStateFromError(e)),a=l.__d),l.componentDidCatch!=null&&(l.componentDidCatch(e,i||{}),a=l.__d),a)return l.__E=l}catch(d){e=d}throw e}},ye=0,I.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=T({},this.state),typeof e=="function"&&(e=e(T({},n),this.props)),e&&T(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),ce(this))},I.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),ce(this))},I.prototype.render=$,L=[],be=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ge=function(e,t){return e.__v.__b-t.__v.__b},j.__r=0,ke=/(PointerCapture)$|Capture$/i,te=0,X=ae(!1),Y=ae(!0);var Oe=0;function s(e,t,n,i,l,r){t||(t={});var a,d,_=t;if("ref"in _)for(d in _={},t)d=="ref"?a=t[d]:_[d]=t[d];var o={type:e,props:_,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Oe,__i:-1,__u:0,__source:l,__self:r};if(typeof e=="function"&&(a=e.defaultProps))for(d in a)_[d]===void 0&&(_[d]=a[d]);return C.vnode&&C.vnode(o),o}var O,R,Q,_e,z=0,Ne=[],P=C,de=P.__b,ue=P.__r,pe=P.diffed,he=P.__c,fe=P.unmount,me=P.__;function le(e,t){P.__h&&P.__h(R,e,z||t),z=0;var n=R.__H||(R.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function S(e){return z=1,De(Te,e)}function De(e,t,n){var i=le(O++,2);if(i.t=e,!i.__c&&(i.__=[Te(void 0,t),function(d){var _=i.__N?i.__N[0]:i.__[0],o=i.t(_,d);_!==o&&(i.__N=[o,i.__[1]],i.__c.setState({}))}],i.__c=R,!R.__f)){var l=function(d,_,o){if(!i.__c.__H)return!0;var h=i.__c.__H.__.filter(function(f){return!!f.__c});if(h.every(function(f){return!f.__N}))return!r||r.call(this,d,_,o);var c=i.__c.props!==d;return h.forEach(function(f){if(f.__N){var u=f.__[0];f.__=f.__N,f.__N=void 0,u!==f.__[0]&&(c=!0)}}),r&&r.call(this,d,_,o)||c};R.__f=!0;var r=R.shouldComponentUpdate,a=R.componentWillUpdate;R.componentWillUpdate=function(d,_,o){if(this.__e){var h=r;r=void 0,l(d,_,o),r=h}a&&a.call(this,d,_,o)},R.shouldComponentUpdate=l}return i.__N||i.__}function N(e,t){var n=le(O++,3);!P.__s&&xe(n.__H,t)&&(n.__=e,n.u=t,R.__H.__h.push(n))}function B(e){return z=5,Me(function(){return{current:e}},[])}function Me(e,t){var n=le(O++,7);return xe(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Ie(){for(var e;e=Ne.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(J),e.__H.__h.forEach(ee),e.__H.__h=[]}catch(t){e.__H.__h=[],P.__e(t,e.__v)}}P.__b=function(e){R=null,de&&de(e)},P.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),me&&me(e,t)},P.__r=function(e){ue&&ue(e),O=0;var t=(R=e.__c).__H;t&&(Q===R?(t.__h=[],R.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(J),t.__h.forEach(ee),t.__h=[],O=0)),Q=R},P.diffed=function(e){pe&&pe(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Ne.push(t)!==1&&_e===P.requestAnimationFrame||((_e=P.requestAnimationFrame)||Be)(Ie)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Q=R=null},P.__c=function(e,t){t.some(function(n){try{n.__h.forEach(J),n.__h=n.__h.filter(function(i){return!i.__||ee(i)})}catch(i){t.some(function(l){l.__h&&(l.__h=[])}),t=[],P.__e(i,n.__v)}}),he&&he(e,t)},P.unmount=function(e){fe&&fe(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{J(i)}catch(l){t=l}}),n.__H=void 0,t&&P.__e(t,n.__v))};var ve=typeof requestAnimationFrame=="function";function Be(e){var t,n=function(){clearTimeout(i),ve&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,35);ve&&(t=requestAnimationFrame(n))}function J(e){var t=R,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),R=t}function ee(e){var t=R;e.__c=e.__(),R=t}function xe(e,t){return!e||e.length!==t.length||t.some(function(n,i){return n!==e[i]})}function Te(e,t){return typeof t=="function"?t(e):t}function Je(e){const[t,n]=S("connecting"),i=B(null),l=B(1),r=B(new Map);N(()=>{const _=new WebSocket(e);return i.current=_,_.onopen=()=>{console.log("WebSocket connected"),n("connected")},_.onclose=()=>{console.log("WebSocket disconnected"),n("disconnected")},_.onerror=o=>{console.error("WebSocket error:",o),n("disconnected")},_.onmessage=o=>{try{const h=JSON.parse(o.data),c="type"in h?h.type:"response",f=r.current.get(c);f&&f.forEach(p=>p(h));const u=r.current.get("*");u&&u.forEach(p=>p(h))}catch(h){console.error("Failed to parse WebSocket message:",h)}},()=>{_.close()}},[e]);const a=(_,o)=>new Promise((h,c)=>{if(!i.current||i.current.readyState!==WebSocket.OPEN){c(new Error("WebSocket not connected"));return}const f=l.current++,u={id:f,type:_,payload:o},k=d("response",v=>{"id"in v&&v.id===f&&(k(),v.ok?h(v.payload):c(new Error(v.error||"Request failed")))});try{i.current.send(JSON.stringify(u))}catch(v){k(),c(v)}setTimeout(()=>{k(),c(new Error("Request timeout"))},3e4)}),d=(_,o)=>(r.current.has(_)||r.current.set(_,new Set),r.current.get(_).add(o),()=>{const h=r.current.get(_);h&&(h.delete(o),h.size===0&&r.current.delete(_))});return{status:t,sendRequest:a,subscribe:d}}function je({onSimulationChange:e}){const[t,n]=S(""),[i,l]=S(""),[r,a]=S(!1),[d,_]=S(null),o=(u,p)=>{_({type:u,text:p}),setTimeout(()=>_(null),5e3)},h=async()=>{if(!t.trim()){o("error","Please enter a world path");return}a(!0);try{const u={world_path:t};i.trim()&&(u.scenario=i.trim());const k=await(await fetch("/api/sim/load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).json();k.success?(o("success",k.message),e==null||e()):o("error",k.message)}catch(u){o("error",`Failed to load simulation: ${u}`)}finally{a(!1)}},c=async()=>{a(!0);try{const p=await(await fetch("/api/sim/restart",{method:"POST"})).json();p.success?(o("success",p.message),e==null||e()):o("error",p.message)}catch(u){o("error",`Failed to restart simulation: ${u}`)}finally{a(!1)}},f=async()=>{a(!0);try{const p=await(await fetch("/api/sim/stop",{method:"POST"})).json();p.success?(o("success",p.message),e==null||e()):o("error",p.message)}catch(u){o("error",`Failed to stop simulation: ${u}`)}finally{a(!1)}};return s("div",{class:"simulation-control",children:[s("div",{class:"control-row",children:[s("input",{type:"text",value:t,onInput:u=>n(u.target.value),placeholder:"Path to world directory (e.g., examples/terra)",class:"world-path-input",disabled:r}),s("input",{type:"text",value:i,onInput:u=>l(u.target.value),placeholder:"Scenario (optional, e.g., default)",class:"scenario-input",disabled:r}),s("button",{onClick:h,disabled:r||!t.trim(),class:"control-btn primary",children:r?"Loading...":"Load World"})]}),s("div",{class:"control-row",children:[s("button",{onClick:c,disabled:r,class:"control-btn",children:"Restart"}),s("button",{onClick:f,disabled:r,class:"control-btn danger",children:"Stop Simulation"})]}),d&&s("div",{class:`message message-${d.type}`,children:d.text})]})}function ze({status:e,tickInfo:t,ws:n,hasErrors:i,onSimulationChange:l}){var U;const[r,a]=S(!1),[d,_]=S("stopped"),[o,h]=S(!0),[c,f]=S(null),[u,p]=S(60),[k,v]=S(!1);N(()=>{i&&_("error")},[i]),N(()=>{t&&(t.execution_state&&_(t.execution_state),t.warmup_complete!==void 0&&(h(t.warmup_complete),!t.warmup_complete&&t.execution_state==="running"&&_("warmup")),t.last_error&&f(t.last_error),t.tick_rate!==void 0&&p(t.tick_rate))},[t]),N(()=>{n.status==="connected"&&n.sendRequest("status").then(w=>{w.execution_state&&_(w.execution_state),w.warmup_complete!==void 0&&h(w.warmup_complete),w.tick_rate!==void 0&&p(w.tick_rate),w.last_error&&f(w.last_error)}).catch(w=>{f(w.message||"Failed to fetch status"),_("error")})},[n.status]);const b=()=>{o||_("warmup"),n.sendRequest("step",{count:1}).then(w=>{h(w.warmup_complete??!0),_("stopped")}).catch(w=>{f(w.message||"Step failed"),_("error")})},g=()=>{o||_("warmup"),n.sendRequest("run",{tick_rate:u}).then(w=>{h(w.warmup_complete??!0),_("running")}).catch(w=>{f(w.message||"Run failed"),_("error")})},m=()=>{n.sendRequest("pause").then(()=>_("paused")).catch(w=>{f(w.message||"Pause failed"),_("error")})},y=()=>{n.sendRequest("resume").then(()=>_("running")).catch(w=>{f(w.message||"Resume failed"),_("error")})},E=()=>{n.sendRequest("stop").then(()=>_("stopped")).catch(console.error)},A=()=>{switch(d){case"running":return"RUNNING";case"stopped":return"STOPPED";case"paused":return"PAUSED";case"warmup":return"WARMUP";case"error":return c||"ERROR"}};return s($,{children:[s("header",{class:"header",children:[s("div",{class:"header-left",children:[s("h1",{children:"Continuum Inspector"}),s("div",{class:`sim-status sim-status-${d}`,children:[s("span",{class:"sim-status-indicator"}),s("span",{class:"sim-status-label",children:A()})]})]}),s("div",{class:"header-controls",children:[s("button",{onClick:()=>a(!r),class:"control-btn",title:"Simulation lifecycle controls",children:[s("span",{class:"icon",children:"⚙"}),r?"Hide":"Sim"," Controls"]}),s("button",{onClick:()=>v(!k),class:"control-btn",title:"Tick rate control",children:[s("span",{class:"icon",children:"⏱"}),u===0?"∞":u," tps"]}),s("button",{onClick:b,disabled:d==="running",class:"control-btn",title:"Step one tick",children:[s("span",{class:"icon",children:"⏭"}),"Step"]}),d==="running"?s("button",{onClick:m,class:"control-btn",title:"Pause simulation",children:[s("span",{class:"icon",children:"⏸"}),"Pause"]}):d==="paused"||d==="error"?s("button",{onClick:y,class:"control-btn primary",title:"Resume simulation",children:[s("span",{class:"icon",children:"▶"}),"Resume"]}):s("button",{onClick:g,disabled:d==="running",class:"control-btn primary",title:"Run simulation",children:[s("span",{class:"icon",children:"▶"}),"Run"]}),s("button",{onClick:E,disabled:d==="stopped",class:"control-btn danger",title:"Stop simulation",children:[s("span",{class:"icon",children:"⏹"}),"Stop"]})]}),s("div",{class:"header-info",children:[t&&s("div",{class:"tick-info",children:[s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Tick"}),s("span",{class:"info-value",children:t.tick})]}),s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Era"}),s("span",{class:"info-value",children:t.era})]}),s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Time"}),s("span",{class:"info-value",children:[(U=t.sim_time)==null?void 0:U.toFixed(2),"s"]})]})]}),s("div",{class:`connection-status connection-${e}`,children:[s("span",{class:"connection-indicator"}),s("span",{class:"connection-label",children:e==="connected"?"Connected":e==="connecting"?"Connecting...":"Disconnected"})]})]})]}),d==="error"&&c&&s("div",{class:"error-banner",children:[s("span",{class:"error-icon",children:"⚠"}),s("span",{class:"error-message",children:["Error: ",c]}),s("button",{onClick:y,class:"control-btn primary",title:"Resume from error",children:"Resume"})]}),k&&s("div",{class:"tick-rate-panel",children:[s("label",{class:"tick-rate-label",children:["Tick Rate: ",u===0?"Unlimited":`${u} tps`]}),s("input",{type:"range",min:"0",max:"120",step:"1",value:u,onInput:w=>{const F=parseInt(w.target.value);p(F)},class:"tick-rate-slider"}),s("div",{class:"tick-rate-presets",children:[s("button",{onClick:()=>p(1),class:"preset-btn",children:"1"}),s("button",{onClick:()=>p(10),class:"preset-btn",children:"10"}),s("button",{onClick:()=>p(30),class:"preset-btn",children:"30"}),s("button",{onClick:()=>p(60),class:"preset-btn",children:"60"}),s("button",{onClick:()=>p(120),class:"preset-btn",children:"120"}),s("button",{onClick:()=>p(0),class:"preset-btn",children:"∞"})]})]}),r&&s("div",{class:"sim-control-panel",children:s(je,{onSimulationChange:()=>{a(!1),l==null||l()}})})]})}function Ve({currentTab:e,onTabChange:t,onSelectItem:n,onEmitImpulse:i,ws:l}){const[r,a]=S([]),[d,_]=S([]),[o,h]=S([]),[c,f]=S([]),[u,p]=S([]);N(()=>l.status!=="connected"?void 0:(l.sendRequest("signal.list").then(y=>{a(Array.isArray(y)?y.map(E=>E.id):[])}).catch(console.error),l.sendRequest("field.list").then(y=>{_(Array.isArray(y)?y.map(E=>E.id):[])}).catch(console.error),l.sendRequest("entity.list").then(y=>{h(Array.isArray(y)?y.map(E=>E.id):[])}).catch(console.error),l.sendRequest("impulse.list").then(y=>{p(y||[])}).catch(console.error),l.subscribe("chronicle.event",y=>{"type"in y&&y.type==="chronicle.event"&&f(E=>[...E,{...y.payload,timestamp:new Date}].slice(-200))})),[l.status]);const k=m=>{l.sendRequest("signal.describe",{signal_id:m}).then(y=>{n({type:"signal",data:y})}).catch(console.error)},v=m=>{l.sendRequest("field.describe",{field_id:m}).then(y=>{n({type:"field",data:y})}).catch(console.error)},b=m=>{l.sendRequest("entity.describe",{entity_id:m}).then(y=>{n({type:"entity",data:y})}).catch(console.error)},g=m=>{n({type:"chronicle",data:m})};return s("div",{class:"tab-panel",children:[s("div",{class:"tabs",children:[s("button",{class:e==="signals"?"active":"",onClick:()=>t("signals"),children:["Signals (",r.length,")"]}),s("button",{class:e==="fields"?"active":"",onClick:()=>t("fields"),children:["Fields (",d.length,")"]}),s("button",{class:e==="entities"?"active":"",onClick:()=>t("entities"),children:["Entities (",o.length,")"]}),s("button",{class:e==="chronicles"?"active":"",onClick:()=>t("chronicles"),children:["Chronicles (",c.length,")"]}),s("button",{class:e==="impulses"?"active":"",onClick:()=>t("impulses"),children:["Impulses (",u.length,")"]})]}),s("div",{class:"tab-content",children:[e==="signals"&&s("div",{class:"item-list",children:r.map(m=>s("div",{class:"item",onClick:()=>k(m),children:m},m))}),e==="fields"&&s("div",{class:"item-list",children:d.map(m=>s("div",{class:"item",onClick:()=>v(m),children:m},m))}),e==="entities"&&s("div",{class:"item-list",children:o.map(m=>s("div",{class:"item",onClick:()=>b(m),children:m},m))}),e==="chronicles"&&s("div",{class:"item-list",children:c.length===0?s("div",{class:"empty",children:"No chronicle events yet..."}):[...c].reverse().map((m,y)=>s("div",{class:"item chronicle-item",onClick:()=>g(m),children:[s("div",{class:"chronicle-name",children:m.name}),s("div",{class:"chronicle-meta",children:["Tick ",m.tick," • Era: ",m.era," • ",m.sim_time.toFixed(2),"s",e==="impulses"&&s("div",{class:"item-list",children:[s("button",{class:"primary emit-btn",onClick:i,children:"Emit Impulse..."}),u.map(E=>s("div",{class:"item",onClick:()=>n({type:"impulse",data:E}),children:E.path},E.path))]})]})]},y))})]})]})}function Ge({selectedItem:e}){if(!e)return s("div",{class:"detail-panel",children:s("div",{class:"empty",children:"Select an item to view details"})});const{type:t,data:n}=e;return s("div",{class:"detail-panel",children:[s("div",{class:"detail-header",children:[s("h2",{children:n.title||n.id||n.name}),s("div",{class:"detail-type",children:t})]}),n.doc&&s("div",{class:"detail-doc",children:n.doc}),s("div",{class:"detail-content",children:[t==="signal"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),s("span",{class:"label",children:"Type:"}),s("span",{children:n.value_type}),n.unit&&s($,{children:[s("span",{class:"label",children:"Unit:"}),s("span",{children:n.unit})]}),n.stratum&&s($,{children:[s("span",{class:"label",children:"Stratum:"}),s("span",{children:n.stratum})]}),n.range&&s($,{children:[s("span",{class:"label",children:"Range:"}),s("span",{children:[n.range[0]," … ",n.range[1]]})]})]}),t==="field"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),s("span",{class:"label",children:"Topology:"}),s("span",{children:n.topology}),s("span",{class:"label",children:"Type:"}),s("span",{children:n.value_type}),n.unit&&s($,{children:[s("span",{class:"label",children:"Unit:"}),s("span",{children:n.unit})]}),n.range&&s($,{children:[s("span",{class:"label",children:"Range:"}),s("span",{children:[n.range[0]," … ",n.range[1]]})]})]}),t==="entity"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),n.count_bounds&&s($,{children:[s("span",{class:"label",children:"Count Bounds:"}),s("span",{children:[n.count_bounds[0]," … ",n.count_bounds[1]]})]})]}),t==="chronicle"&&s($,{children:[s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"Event:"}),s("span",{children:n.name}),s("span",{class:"label",children:"Tick:"}),s("span",{children:n.tick}),s("span",{class:"label",children:"Era:"}),s("span",{children:n.era}),s("span",{class:"label",children:"Sim Time:"}),s("span",{children:[n.sim_time.toFixed(2),"s"]})]}),n.fields&&n.fields.length>0&&s("div",{class:"detail-section",children:[s("h3",{children:"Fields"}),s("div",{class:"detail-grid",children:n.fields.map(([i,l])=>s($,{children:[s("span",{class:"label",children:[i,":"]}),s("span",{children:JSON.stringify(l)})]}))})]})]}),t==="assertion"&&s($,{children:s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"Signal:"}),s("span",{children:n.signal_id}),s("span",{class:"label",children:"Severity:"}),s("span",{class:`severity-${n.severity}`,children:n.severity.toUpperCase()}),s("span",{class:"label",children:"Message:"}),s("span",{children:n.message}),s("span",{class:"label",children:"Tick:"}),s("span",{children:n.tick}),s("span",{class:"label",children:"Era:"}),s("span",{children:n.era}),s("span",{class:"label",children:"Sim Time:"}),s("span",{children:[n.sim_time.toFixed(2),"s"]})]})}),t==="impulse"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"Path:"}),s("span",{children:n.path}),s("span",{class:"label",children:"Payload Type:"}),s("span",{children:n.payload_type||"None"})]})]})]})}function Ke({ws:e}){const[t,n]=S([]),i=B(null);return N(()=>e.status!=="connected"?void 0:e.subscribe("*",a=>{const d={timestamp:new Date,type:"type"in a&&a.type.includes("event")?"event":"error"in a?"error":"info",message:JSON.stringify(a,null,2)};n(_=>[..._,d].slice(-500))}),[e.status]),N(()=>{var r;(r=i.current)==null||r.scrollIntoView({behavior:"smooth"})},[t]),s("div",{class:"log-panel",children:[s("div",{class:"log-header",children:[s("h3",{children:"Log"}),s("button",{onClick:()=>{n([])},class:"small",children:"Clear"})]}),s("div",{class:"log-content",children:[t.map((r,a)=>s("div",{class:`log-entry log-${r.type}`,children:[s("span",{class:"log-time",children:["[",r.timestamp.toLocaleTimeString(),"]"]}),s("span",{class:"log-message",children:r.message})]},a)),s("div",{ref:i})]})]})}function Qe({ws:e,onSelectAssertion:t}){const[n,i]=S([]),[l,r]=S("all");N(()=>e.status!=="connected"?void 0:((()=>{e.sendRequest("assertion.failures").then(h=>{i(h.failures||[])}).catch(console.error)})(),e.subscribe("assertion",h=>{h.payload&&i(c=>[h.payload,...c].slice(0,200))})),[e.status]);const a=l==="all"?n:n.filter(_=>_.severity===l),d={warn:n.filter(_=>_.severity==="warn").length,error:n.filter(_=>_.severity==="error").length,fatal:n.filter(_=>_.severity==="fatal").length};return s("div",{class:"assertion-panel",children:[s("div",{class:"assertion-header",children:[s("h3",{children:"Assertions"}),s("div",{class:"assertion-filters",children:[s("button",{class:`filter-btn ${l==="all"?"active":""}`,onClick:()=>r("all"),children:["All (",n.length,")"]}),s("button",{class:`filter-btn severity-warn ${l==="warn"?"active":""}`,onClick:()=>r("warn"),children:["Warn (",d.warn,")"]}),s("button",{class:`filter-btn severity-error ${l==="error"?"active":""}`,onClick:()=>r("error"),children:["Error (",d.error,")"]}),s("button",{class:`filter-btn severity-fatal ${l==="fatal"?"active":""}`,onClick:()=>r("fatal"),children:["Fatal (",d.fatal,")"]})]})]}),s("div",{class:"assertion-content",children:a.length===0?s("div",{class:"empty",children:l==="all"?"No assertion failures":`No ${l} assertions`}):s("div",{class:"assertion-list",children:a.map((_,o)=>s("div",{class:`assertion-item severity-${_.severity}`,onClick:()=>t(_),children:[s("div",{class:"assertion-row",children:[s("span",{class:`assertion-badge severity-${_.severity}`,children:_.severity.toUpperCase()}),s("span",{class:"assertion-signal",children:_.signal_id}),s("span",{class:"assertion-tick",children:["Tick ",_.tick]})]}),s("div",{class:"assertion-message",children:_.message})]},o))})})]})}function Xe({isOpen:e,onClose:t,ws:n}){var f,u;const[i,l]=S([]),[r,a]=S(null),[d,_]=S(""),[o,h]=S(null);N(()=>{e&&n.status==="connected"&&n.sendRequest("impulse.list").then(p=>{l(p||[])}).catch(console.error)},[e,n.status]);const c=async()=>{var k,v;if(!r)return;let p;try{if((k=r.payload_type)!=null&&k.toLowerCase().includes("scalar")){if(p=parseFloat(d),isNaN(p))throw new Error("Invalid scalar value")}else(v=r.payload_type)!=null&&v.toLowerCase().includes("bool")?p=d.toLowerCase()==="true":d.trim().startsWith("{")||d.trim().startsWith("[")?p=JSON.parse(d):p=d;const b=await n.sendRequest("impulse.emit",{path:r.path,payload:p});h({type:"success",message:"Impulse emitted successfully"}),setTimeout(()=>{h(null),t()},1500)}catch(b){h({type:"error",message:b.message})}};return e?s("div",{class:"modal-overlay",onClick:t,children:s("div",{class:"modal-content",onClick:p=>p.stopPropagation(),children:[s("div",{class:"modal-header",children:[s("h2",{children:"Emit Impulse"}),s("button",{class:"close-btn",onClick:t,children:"×"})]}),s("div",{class:"modal-body",children:[s("div",{class:"form-group",children:[s("label",{children:"Select Impulse"}),s("select",{value:(r==null?void 0:r.path)||"",onChange:p=>{const k=i.find(v=>v.path===p.target.value);a(k||null),h(null)},children:[s("option",{value:"",children:"-- Choose an impulse --"}),i.map(p=>s("option",{value:p.path,children:p.path},p.path))]})]}),r&&s("div",{class:"impulse-details",children:[r.doc&&s("p",{class:"doc-text",children:r.doc}),s("div",{class:"form-group",children:[s("label",{children:["Payload (",r.payload_type||"Unknown Type",")"]}),(f=r.payload_type)!=null&&f.toLowerCase().includes("scalar")?s("input",{type:"number",step:"any",value:d,onInput:p=>_(p.target.value),placeholder:"Enter numeric value"}):(u=r.payload_type)!=null&&u.toLowerCase().includes("bool")?s("select",{value:d,onChange:p=>_(p.target.value),children:[s("option",{value:"true",children:"True"}),s("option",{value:"false",children:"False"})]}):s("textarea",{value:d,onInput:p=>_(p.target.value),placeholder:"Enter JSON or string payload"})]})]}),o&&s("div",{class:`status-message ${o.type}`,children:o.message})]}),s("div",{class:"modal-footer",children:[s("button",{class:"secondary",onClick:t,children:"Cancel"}),s("button",{class:"primary",onClick:c,disabled:!r||!d,children:"Emit"})]})]})}):null}function Ye(){const e=Je(`ws://${location.host}/ws`),[t,n]=S("signals"),[i,l]=S(null),[r,a]=S(null),[d,_]=S(0),[o,h]=S(!1),c=()=>{window.location.reload()};N(()=>{if(e.status!=="connected")return;const u=e.subscribe("tick",p=>{"type"in p&&p.type==="tick"&&a(p.payload)});return e.sendRequest("status").then(p=>{p&&a(p)}).catch(console.error),u},[e.status]),N(()=>e.status!=="connected"?void 0:(e.sendRequest("assertion.failures").then(p=>{_((p.failures||[]).length)}).catch(console.error),e.subscribe("assertion",()=>{_(p=>p+1)})),[e.status]);const f=u=>{l({type:"assertion",data:u})};return s("div",{class:"app",children:[s(ze,{status:e.status,tickInfo:r,ws:e,hasErrors:d>0,onSimulationChange:c}),s("div",{class:"main-layout",children:[s(Ve,{currentTab:t,onTabChange:n,onSelectItem:l,onEmitImpulse:()=>h(!0),ws:e}),s("div",{class:"center-panel",children:[s(Ge,{selectedItem:i,ws:e}),s(Ke,{ws:e})]}),s(Qe,{ws:e,onSelectAssertion:f})]}),s(Xe,{isOpen:o,onClose:()=>h(!1),ws:e})]})}We(s(Ye,{}),document.getElementById("app"));
