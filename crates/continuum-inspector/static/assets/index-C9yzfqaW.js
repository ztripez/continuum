(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}})();var z,b,ye,T,le,be,ge,ke,ee,Q,X,L={},we=[],He=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,V=Array.isArray;function E(e,t){for(var n in t)e[n]=t[n];return e}function te(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Ae(e,t,n){var i,l,r,o={};for(r in t)r=="key"?i=t[r]:r=="ref"?l=t[r]:o[r]=t[r];if(arguments.length>2&&(o.children=arguments.length>3?z.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(r in e.defaultProps)o[r]===void 0&&(o[r]=e.defaultProps[r]);return O(e,o,i,l,null)}function O(e,t,n,i,l){var r={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:l??++ye,__i:-1,__u:0};return l==null&&b.vnode!=null&&b.vnode(r),r}function $(e){return e.children}function M(e,t){this.props=e,this.context=t}function H(e,t){if(t==null)return e.__?H(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?H(e):null}function Se(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Se(e)}}function ce(e){(!e.__d&&(e.__d=!0)&&T.push(e)&&!j.__r++||le!=b.debounceRendering)&&((le=b.debounceRendering)||be)(j)}function j(){for(var e,t,n,i,l,r,o,d=1;T.length;)T.length>d&&T.sort(ge),e=T.shift(),d=T.length,e.__d&&(n=void 0,i=void 0,l=(i=(t=e).__v).__e,r=[],o=[],t.__P&&((n=E({},i)).__v=i.__v+1,b.vnode&&b.vnode(n),ne(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[l]:null,r,l??H(i),!!(32&i.__u),o),n.__v=i.__v,n.__.__k[n.__i]=n,Pe(r,n,o),i.__e=i.__=null,n.__e!=l&&Se(n)));j.__r=0}function $e(e,t,n,i,l,r,o,d,_,a,h){var c,p,u,y,g,f,v,m=i&&i.__k||we,P=t.length;for(_=Fe(n,t,m,_,P),c=0;c<P;c++)(u=n.__k[c])!=null&&(p=u.__i==-1?L:m[u.__i]||L,u.__i=c,f=ne(e,u,p,l,r,o,d,_,a,h),y=u.__e,u.ref&&p.ref!=u.ref&&(p.ref&&se(p.ref,null,u),h.push(u.ref,u.__c||y,u)),g==null&&y!=null&&(g=y),(v=!!(4&u.__u))||p.__k===u.__k?_=Ce(u,_,e,v):typeof u.type=="function"&&f!==void 0?_=f:y&&(_=y.nextSibling),u.__u&=-7);return n.__e=g,_}function Fe(e,t,n,i,l){var r,o,d,_,a,h=n.length,c=h,p=0;for(e.__k=new Array(l),r=0;r<l;r++)(o=t[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=e.__k[r]=O(null,o,null,null,null):V(o)?o=e.__k[r]=O($,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=e.__k[r]=O(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):e.__k[r]=o,_=r+p,o.__=e,o.__b=e.__b+1,d=null,(a=o.__i=Le(o,n,_,c))!=-1&&(c--,(d=n[a])&&(d.__u|=2)),d==null||d.__v==null?(a==-1&&(l>h?p--:l<h&&p++),typeof o.type!="function"&&(o.__u|=4)):a!=_&&(a==_-1?p--:a==_+1?p++:(a>_?p--:p++,o.__u|=4))):e.__k[r]=null;if(c)for(r=0;r<h;r++)(d=n[r])!=null&&!(2&d.__u)&&(d.__e==i&&(i=H(d)),Re(d,d));return i}function Ce(e,t,n,i){var l,r;if(typeof e.type=="function"){for(l=e.__k,r=0;l&&r<l.length;r++)l[r]&&(l[r].__=e,t=Ce(l[r],t,n,i));return t}e.__e!=t&&(i&&(t&&e.type&&!t.parentNode&&(t=H(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Le(e,t,n,i){var l,r,o,d=e.key,_=e.type,a=t[n],h=a!=null&&(2&a.__u)==0;if(a===null&&d==null||h&&d==a.key&&_==a.type)return n;if(i>(h?1:0)){for(l=n-1,r=n+1;l>=0||r<t.length;)if((a=t[o=l>=0?l--:r++])!=null&&!(2&a.__u)&&d==a.key&&_==a.type)return o}return-1}function oe(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||He.test(t)?n:n+"px"}function W(e,t,n,i,l){var r,o;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof i=="string"&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||oe(e.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||oe(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")r=t!=(t=t.replace(ke,"$1")),o=t.toLowerCase(),t=o in e||t=="onFocusOut"||t=="onFocusIn"?o.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?i?n.u=i.u:(n.u=ee,e.addEventListener(t,r?X:Q,r)):e.removeEventListener(t,r?X:Q,r);else{if(l=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function ae(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=ee++;else if(t.t<n.u)return;return n(b.event?b.event(t):t)}}}function ne(e,t,n,i,l,r,o,d,_,a){var h,c,p,u,y,g,f,v,m,P,N,U,A,ie,D,F,G,C=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(_=!!(32&n.__u),r=[d=t.__e=n.__e]),(h=b.__b)&&h(t);e:if(typeof C=="function")try{if(v=t.props,m="prototype"in C&&C.prototype.render,P=(h=C.contextType)&&i[h.__c],N=h?P?P.props.value:h.__:i,n.__c?f=(c=t.__c=n.__c).__=c.__E:(m?t.__c=c=new C(v,N):(t.__c=c=new M(v,N),c.constructor=C,c.render=Ue),P&&P.sub(c),c.state||(c.state={}),c.__n=i,p=c.__d=!0,c.__h=[],c._sb=[]),m&&c.__s==null&&(c.__s=c.state),m&&C.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=E({},c.__s)),E(c.__s,C.getDerivedStateFromProps(v,c.__s))),u=c.props,y=c.state,c.__v=t,p)m&&C.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),m&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(m&&C.getDerivedStateFromProps==null&&v!==u&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(v,N),t.__v==n.__v||!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(v,c.__s,N)===!1){for(t.__v!=n.__v&&(c.props=v,c.state=c.__s,c.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(x){x&&(x.__=t)}),U=0;U<c._sb.length;U++)c.__h.push(c._sb[U]);c._sb=[],c.__h.length&&o.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(v,c.__s,N),m&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(u,y,g)})}if(c.context=N,c.props=v,c.__P=e,c.__e=!1,A=b.__r,ie=0,m){for(c.state=c.__s,c.__d=!1,A&&A(t),h=c.render(c.props,c.state,c.context),D=0;D<c._sb.length;D++)c.__h.push(c._sb[D]);c._sb=[]}else do c.__d=!1,A&&A(t),h=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++ie<25);c.state=c.__s,c.getChildContext!=null&&(i=E(E({},i),c.getChildContext())),m&&!p&&c.getSnapshotBeforeUpdate!=null&&(g=c.getSnapshotBeforeUpdate(u,y)),F=h,h!=null&&h.type===$&&h.key==null&&(F=Ee(h.props.children)),d=$e(e,V(F)?F:[F],t,n,i,l,r,o,d,_,a),c.base=t.__e,t.__u&=-161,c.__h.length&&o.push(c),f&&(c.__E=c.__=null)}catch(x){if(t.__v=null,_||r!=null)if(x.then){for(t.__u|=_?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;r[r.indexOf(d)]=null,t.__e=d}else{for(G=r.length;G--;)te(r[G]);Y(t)}else t.__e=n.__e,t.__k=n.__k,x.then||Y(t);b.__e(x,t,n)}else r==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):d=t.__e=qe(n.__e,t,n,i,l,r,o,_,a);return(h=b.diffed)&&h(t),128&t.__u?void 0:d}function Y(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Y)}function Pe(e,t,n){for(var i=0;i<n.length;i++)se(n[i],n[++i],n[++i]);b.__c&&b.__c(t,e),e.some(function(l){try{e=l.__h,l.__h=[],e.some(function(r){r.call(l)})}catch(r){b.__e(r,l.__v)}})}function Ee(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:V(e)?e.map(Ee):E({},e)}function qe(e,t,n,i,l,r,o,d,_){var a,h,c,p,u,y,g,f=n.props||L,v=t.props,m=t.type;if(m=="svg"?l="http://www.w3.org/2000/svg":m=="math"?l="http://www.w3.org/1998/Math/MathML":l||(l="http://www.w3.org/1999/xhtml"),r!=null){for(a=0;a<r.length;a++)if((u=r[a])&&"setAttribute"in u==!!m&&(m?u.localName==m:u.nodeType==3)){e=u,r[a]=null;break}}if(e==null){if(m==null)return document.createTextNode(v);e=document.createElementNS(l,m,v.is&&v),d&&(b.__m&&b.__m(t,r),d=!1),r=null}if(m==null)f===v||d&&e.data==v||(e.data=v);else{if(r=r&&z.call(e.childNodes),!d&&r!=null)for(f={},a=0;a<e.attributes.length;a++)f[(u=e.attributes[a]).name]=u.value;for(a in f)if(u=f[a],a!="children"){if(a=="dangerouslySetInnerHTML")c=u;else if(!(a in v)){if(a=="value"&&"defaultValue"in v||a=="checked"&&"defaultChecked"in v)continue;W(e,a,null,u,l)}}for(a in v)u=v[a],a=="children"?p=u:a=="dangerouslySetInnerHTML"?h=u:a=="value"?y=u:a=="checked"?g=u:d&&typeof u!="function"||f[a]===u||W(e,a,u,f[a],l);if(h)d||c&&(h.__html==c.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(c&&(e.innerHTML=""),$e(t.type=="template"?e.content:e,V(p)?p:[p],t,n,i,m=="foreignObject"?"http://www.w3.org/1999/xhtml":l,r,o,r?r[0]:n.__k&&H(n,0),d,_),r!=null)for(a=r.length;a--;)te(r[a]);d||(a="value",m=="progress"&&y==null?e.removeAttribute("value"):y!=null&&(y!==e[a]||m=="progress"&&!y||m=="option"&&y!=f[a])&&W(e,a,y,f[a],l),a="checked",g!=null&&g!=e[a]&&W(e,a,g,f[a],l))}return e}function se(e,t,n){try{if(typeof e=="function"){var i=typeof e.__u=="function";i&&e.__u(),i&&t==null||(e.__u=e(t))}else e.current=t}catch(l){b.__e(l,n)}}function Re(e,t,n){var i,l;if(b.unmount&&b.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||se(i,null,t)),(i=e.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){b.__e(r,t)}i.base=i.__P=null}if(i=e.__k)for(l=0;l<i.length;l++)i[l]&&Re(i[l],t,n||typeof e.type!="function");n||te(e.__e),e.__c=e.__=e.__e=void 0}function Ue(e,t,n){return this.constructor(e,n)}function De(e,t,n){var i,l,r,o;t==document&&(t=document.documentElement),b.__&&b.__(e,t),l=(i=!1)?null:t.__k,r=[],o=[],ne(t,e=t.__k=Ae($,null,[e]),l||L,L,t.namespaceURI,l?null:t.firstChild?z.call(t.childNodes):null,r,l?l.__e:t.firstChild,i,o),Pe(r,e,o)}z=we.slice,b={__e:function(e,t,n,i){for(var l,r,o;t=t.__;)if((l=t.__c)&&!l.__)try{if((r=l.constructor)&&r.getDerivedStateFromError!=null&&(l.setState(r.getDerivedStateFromError(e)),o=l.__d),l.componentDidCatch!=null&&(l.componentDidCatch(e,i||{}),o=l.__d),o)return l.__E=l}catch(d){e=d}throw e}},ye=0,M.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=E({},this.state),typeof e=="function"&&(e=e(E({},n),this.props)),e&&E(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),ce(this))},M.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),ce(this))},M.prototype.render=$,T=[],be=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ge=function(e,t){return e.__v.__b-t.__v.__b},j.__r=0,ke=/(PointerCapture)$|Capture$/i,ee=0,Q=ae(!1),X=ae(!0);var We=0;function s(e,t,n,i,l,r){t||(t={});var o,d,_=t;if("ref"in _)for(d in _={},t)d=="ref"?o=t[d]:_[d]=t[d];var a={type:e,props:_,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--We,__i:-1,__u:0,__source:l,__self:r};if(typeof e=="function"&&(o=e.defaultProps))for(d in o)_[d]===void 0&&(_[d]=o[d]);return b.vnode&&b.vnode(a),a}var q,k,K,_e,J=0,Ne=[],w=b,de=w.__b,ue=w.__r,he=w.diffed,pe=w.__c,fe=w.unmount,ve=w.__;function re(e,t){w.__h&&w.__h(k,e,J||t),J=0;var n=k.__H||(k.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function S(e){return J=1,Oe(xe,e)}function Oe(e,t,n){var i=re(q++,2);if(i.t=e,!i.__c&&(i.__=[xe(void 0,t),function(d){var _=i.__N?i.__N[0]:i.__[0],a=i.t(_,d);_!==a&&(i.__N=[a,i.__[1]],i.__c.setState({}))}],i.__c=k,!k.__f)){var l=function(d,_,a){if(!i.__c.__H)return!0;var h=i.__c.__H.__.filter(function(p){return!!p.__c});if(h.every(function(p){return!p.__N}))return!r||r.call(this,d,_,a);var c=i.__c.props!==d;return h.forEach(function(p){if(p.__N){var u=p.__[0];p.__=p.__N,p.__N=void 0,u!==p.__[0]&&(c=!0)}}),r&&r.call(this,d,_,a)||c};k.__f=!0;var r=k.shouldComponentUpdate,o=k.componentWillUpdate;k.componentWillUpdate=function(d,_,a){if(this.__e){var h=r;r=void 0,l(d,_,a),r=h}o&&o.call(this,d,_,a)},k.shouldComponentUpdate=l}return i.__N||i.__}function R(e,t){var n=re(q++,3);!w.__s&&Te(n.__H,t)&&(n.__=e,n.u=t,k.__H.__h.push(n))}function I(e){return J=5,Me(function(){return{current:e}},[])}function Me(e,t){var n=re(q++,7);return Te(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Ie(){for(var e;e=Ne.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(B),e.__H.__h.forEach(Z),e.__H.__h=[]}catch(t){e.__H.__h=[],w.__e(t,e.__v)}}w.__b=function(e){k=null,de&&de(e)},w.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),ve&&ve(e,t)},w.__r=function(e){ue&&ue(e),q=0;var t=(k=e.__c).__H;t&&(K===k?(t.__h=[],k.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(B),t.__h.forEach(Z),t.__h=[],q=0)),K=k},w.diffed=function(e){he&&he(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Ne.push(t)!==1&&_e===w.requestAnimationFrame||((_e=w.requestAnimationFrame)||Be)(Ie)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),K=k=null},w.__c=function(e,t){t.some(function(n){try{n.__h.forEach(B),n.__h=n.__h.filter(function(i){return!i.__||Z(i)})}catch(i){t.some(function(l){l.__h&&(l.__h=[])}),t=[],w.__e(i,n.__v)}}),pe&&pe(e,t)},w.unmount=function(e){fe&&fe(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{B(i)}catch(l){t=l}}),n.__H=void 0,t&&w.__e(t,n.__v))};var me=typeof requestAnimationFrame=="function";function Be(e){var t,n=function(){clearTimeout(i),me&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,35);me&&(t=requestAnimationFrame(n))}function B(e){var t=k,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),k=t}function Z(e){var t=k;e.__c=e.__(),k=t}function Te(e,t){return!e||e.length!==t.length||t.some(function(n,i){return n!==e[i]})}function xe(e,t){return typeof t=="function"?t(e):t}function je(e){const[t,n]=S("connecting"),i=I(null),l=I(1),r=I(new Map);R(()=>{const _=new WebSocket(e);return i.current=_,_.onopen=()=>{console.log("WebSocket connected"),n("connected")},_.onclose=()=>{console.log("WebSocket disconnected"),n("disconnected")},_.onerror=a=>{console.error("WebSocket error:",a),n("disconnected")},_.onmessage=a=>{try{const h=JSON.parse(a.data),c="type"in h?h.type:"response",p=r.current.get(c);p&&p.forEach(y=>y(h));const u=r.current.get("*");u&&u.forEach(y=>y(h))}catch(h){console.error("Failed to parse WebSocket message:",h)}},()=>{_.close()}},[e]);const o=(_,a)=>new Promise((h,c)=>{if(!i.current||i.current.readyState!==WebSocket.OPEN){c(new Error("WebSocket not connected"));return}const p=l.current++,u={id:p,type:_,payload:a},g=d("response",f=>{"id"in f&&f.id===p&&(g(),f.ok?h(f.payload):c(new Error(f.error||"Request failed")))});try{i.current.send(JSON.stringify(u))}catch(f){g(),c(f)}setTimeout(()=>{g(),c(new Error("Request timeout"))},3e4)}),d=(_,a)=>(r.current.has(_)||r.current.set(_,new Set),r.current.get(_).add(a),()=>{const h=r.current.get(_);h&&(h.delete(a),h.size===0&&r.current.delete(_))});return{status:t,sendRequest:o,subscribe:d}}function Je({onSimulationChange:e}){const[t,n]=S(""),[i,l]=S(""),[r,o]=S(!1),[d,_]=S(null),a=(u,y)=>{_({type:u,text:y}),setTimeout(()=>_(null),5e3)},h=async()=>{if(!t.trim()){a("error","Please enter a world path");return}o(!0);try{const u={world_path:t};i.trim()&&(u.scenario=i.trim());const g=await(await fetch("/api/sim/load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).json();g.success?(a("success",g.message),e==null||e()):a("error",g.message)}catch(u){a("error",`Failed to load simulation: ${u}`)}finally{o(!1)}},c=async()=>{o(!0);try{const y=await(await fetch("/api/sim/restart",{method:"POST"})).json();y.success?(a("success",y.message),e==null||e()):a("error",y.message)}catch(u){a("error",`Failed to restart simulation: ${u}`)}finally{o(!1)}},p=async()=>{o(!0);try{const y=await(await fetch("/api/sim/stop",{method:"POST"})).json();y.success?(a("success",y.message),e==null||e()):a("error",y.message)}catch(u){a("error",`Failed to stop simulation: ${u}`)}finally{o(!1)}};return s("div",{class:"simulation-control",children:[s("div",{class:"control-row",children:[s("input",{type:"text",value:t,onInput:u=>n(u.target.value),placeholder:"Path to world directory (e.g., examples/terra)",class:"world-path-input",disabled:r}),s("input",{type:"text",value:i,onInput:u=>l(u.target.value),placeholder:"Scenario (optional, e.g., default)",class:"scenario-input",disabled:r}),s("button",{onClick:h,disabled:r||!t.trim(),class:"control-btn primary",children:r?"Loading...":"Load World"})]}),s("div",{class:"control-row",children:[s("button",{onClick:c,disabled:r,class:"control-btn",children:"Restart"}),s("button",{onClick:p,disabled:r,class:"control-btn danger",children:"Stop Simulation"})]}),d&&s("div",{class:`message message-${d.type}`,children:d.text})]})}function ze({status:e,tickInfo:t,ws:n,hasErrors:i,onSimulationChange:l}){var v;const[r,o]=S(!1),[d,_]=S("stopped"),[a,h]=S(!0),[c,p]=S(null);R(()=>{i&&_("error")},[i]),R(()=>{n.status==="connected"&&n.sendRequest("status").then(m=>{h(m.warmup_complete??!0),m.warmup_complete?_(m.running?"running":"stopped"):_("warmup")}).catch(console.error)},[n.status]);const u=()=>{a||_("warmup"),n.sendRequest("step",{count:1}).then(m=>{h(m.warmup_complete??!0),_("stopped")}).catch(m=>{p(m.message||"Step failed"),_("error")})},y=()=>{a||_("warmup"),n.sendRequest("run").then(m=>{h(m.warmup_complete??!0),_("running")}).catch(m=>{p(m.message||"Run failed"),_("error")})},g=()=>{n.sendRequest("stop").then(()=>_("stopped")).catch(console.error)},f=()=>{switch(d){case"running":return"RUNNING";case"stopped":return"STOPPED";case"paused":return"PAUSED";case"warmup":return"WARMUP";case"error":return c||"ERROR"}};return s($,{children:[s("header",{class:"header",children:[s("div",{class:"header-left",children:[s("h1",{children:"Continuum Inspector"}),s("div",{class:`sim-status sim-status-${d}`,children:[s("span",{class:"sim-status-indicator"}),s("span",{class:"sim-status-label",children:f()})]})]}),s("div",{class:"header-controls",children:[s("button",{onClick:()=>o(!r),class:"control-btn",title:"Simulation lifecycle controls",children:[s("span",{class:"icon",children:"⚙"}),r?"Hide":"Sim"," Controls"]}),s("button",{onClick:u,disabled:d==="running",class:"control-btn",title:"Step one tick",children:[s("span",{class:"icon",children:"⏭"}),"Step"]}),s("button",{onClick:y,disabled:d==="running",class:"control-btn primary",title:"Run simulation",children:[s("span",{class:"icon",children:"▶"}),"Run"]}),s("button",{onClick:g,disabled:d==="stopped"||d==="error",class:"control-btn danger",title:"Stop simulation",children:[s("span",{class:"icon",children:"⏹"}),"Stop"]})]}),s("div",{class:"header-info",children:[t&&s("div",{class:"tick-info",children:[s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Tick"}),s("span",{class:"info-value",children:t.tick})]}),s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Era"}),s("span",{class:"info-value",children:t.era})]}),s("div",{class:"info-item",children:[s("span",{class:"info-label",children:"Time"}),s("span",{class:"info-value",children:[(v=t.sim_time)==null?void 0:v.toFixed(2),"s"]})]})]}),s("div",{class:`connection-status connection-${e}`,children:[s("span",{class:"connection-indicator"}),s("span",{class:"connection-label",children:e==="connected"?"Connected":e==="connecting"?"Connecting...":"Disconnected"})]})]})]}),r&&s("div",{class:"sim-control-panel",children:s(Je,{onSimulationChange:()=>{o(!1),l==null||l()}})})]})}function Ve({currentTab:e,onTabChange:t,onSelectItem:n,ws:i}){const[l,r]=S([]),[o,d]=S([]),[_,a]=S([]),[h,c]=S([]);R(()=>i.status!=="connected"?void 0:(i.sendRequest("signal.list").then(v=>{r(v.signals||[])}).catch(console.error),i.sendRequest("field.list").then(v=>{d(v.fields||[])}).catch(console.error),i.sendRequest("entity.list").then(v=>{a(v.entities||[])}).catch(console.error),i.subscribe("chronicle.event",v=>{"type"in v&&v.type==="chronicle.event"&&c(m=>[...m,{...v.payload,timestamp:new Date}].slice(-200))})),[i.status]);const p=f=>{i.sendRequest("signal.describe",{signal_id:f}).then(v=>{n({type:"signal",data:v})}).catch(console.error)},u=f=>{i.sendRequest("field.describe",{field_id:f}).then(v=>{n({type:"field",data:v})}).catch(console.error)},y=f=>{i.sendRequest("entity.describe",{entity_id:f}).then(v=>{n({type:"entity",data:v})}).catch(console.error)},g=f=>{n({type:"chronicle",data:f})};return s("div",{class:"tab-panel",children:[s("div",{class:"tabs",children:[s("button",{class:e==="signals"?"active":"",onClick:()=>t("signals"),children:["Signals (",l.length,")"]}),s("button",{class:e==="fields"?"active":"",onClick:()=>t("fields"),children:["Fields (",o.length,")"]}),s("button",{class:e==="entities"?"active":"",onClick:()=>t("entities"),children:["Entities (",_.length,")"]}),s("button",{class:e==="chronicles"?"active":"",onClick:()=>t("chronicles"),children:["Chronicles (",h.length,")"]})]}),s("div",{class:"tab-content",children:[e==="signals"&&s("div",{class:"item-list",children:l.map(f=>s("div",{class:"item",onClick:()=>p(f),children:f},f))}),e==="fields"&&s("div",{class:"item-list",children:o.map(f=>s("div",{class:"item",onClick:()=>u(f),children:f},f))}),e==="entities"&&s("div",{class:"item-list",children:_.map(f=>s("div",{class:"item",onClick:()=>y(f),children:f},f))}),e==="chronicles"&&s("div",{class:"item-list",children:h.length===0?s("div",{class:"empty",children:"No chronicle events yet..."}):[...h].reverse().map((f,v)=>s("div",{class:"item chronicle-item",onClick:()=>g(f),children:[s("div",{class:"chronicle-name",children:f.name}),s("div",{class:"chronicle-meta",children:["Tick ",f.tick," • Era: ",f.era," • ",f.sim_time.toFixed(2),"s"]})]},v))})]})]})}function Ge({selectedItem:e}){if(!e)return s("div",{class:"detail-panel",children:s("div",{class:"empty",children:"Select an item to view details"})});const{type:t,data:n}=e;return s("div",{class:"detail-panel",children:[s("div",{class:"detail-header",children:[s("h2",{children:n.title||n.id||n.name}),s("div",{class:"detail-type",children:t})]}),n.doc&&s("div",{class:"detail-doc",children:n.doc}),s("div",{class:"detail-content",children:[t==="signal"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),s("span",{class:"label",children:"Type:"}),s("span",{children:n.value_type}),n.unit&&s($,{children:[s("span",{class:"label",children:"Unit:"}),s("span",{children:n.unit})]}),n.stratum&&s($,{children:[s("span",{class:"label",children:"Stratum:"}),s("span",{children:n.stratum})]}),n.range&&s($,{children:[s("span",{class:"label",children:"Range:"}),s("span",{children:[n.range[0]," … ",n.range[1]]})]})]}),t==="field"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),s("span",{class:"label",children:"Topology:"}),s("span",{children:n.topology}),s("span",{class:"label",children:"Type:"}),s("span",{children:n.value_type}),n.unit&&s($,{children:[s("span",{class:"label",children:"Unit:"}),s("span",{children:n.unit})]}),n.range&&s($,{children:[s("span",{class:"label",children:"Range:"}),s("span",{children:[n.range[0]," … ",n.range[1]]})]})]}),t==="entity"&&s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"ID:"}),s("span",{children:n.id}),n.count_bounds&&s($,{children:[s("span",{class:"label",children:"Count Bounds:"}),s("span",{children:[n.count_bounds[0]," … ",n.count_bounds[1]]})]})]}),t==="chronicle"&&s($,{children:[s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"Event:"}),s("span",{children:n.name}),s("span",{class:"label",children:"Tick:"}),s("span",{children:n.tick}),s("span",{class:"label",children:"Era:"}),s("span",{children:n.era}),s("span",{class:"label",children:"Sim Time:"}),s("span",{children:[n.sim_time.toFixed(2),"s"]})]}),n.fields&&n.fields.length>0&&s("div",{class:"detail-section",children:[s("h3",{children:"Fields"}),s("div",{class:"detail-grid",children:n.fields.map(([i,l])=>s($,{children:[s("span",{class:"label",children:[i,":"]}),s("span",{children:JSON.stringify(l)})]}))})]})]}),t==="assertion"&&s($,{children:s("div",{class:"detail-grid",children:[s("span",{class:"label",children:"Signal:"}),s("span",{children:n.signal_id}),s("span",{class:"label",children:"Severity:"}),s("span",{class:`severity-${n.severity}`,children:n.severity.toUpperCase()}),s("span",{class:"label",children:"Message:"}),s("span",{children:n.message}),s("span",{class:"label",children:"Tick:"}),s("span",{children:n.tick}),s("span",{class:"label",children:"Era:"}),s("span",{children:n.era}),s("span",{class:"label",children:"Sim Time:"}),s("span",{children:[n.sim_time.toFixed(2),"s"]})]})})]})]})}function Ke({ws:e}){const[t,n]=S([]),i=I(null);return R(()=>e.status!=="connected"?void 0:e.subscribe("*",o=>{const d={timestamp:new Date,type:"type"in o&&o.type.includes("event")?"event":"error"in o?"error":"info",message:JSON.stringify(o,null,2)};n(_=>[..._,d].slice(-500))}),[e.status]),R(()=>{var r;(r=i.current)==null||r.scrollIntoView({behavior:"smooth"})},[t]),s("div",{class:"log-panel",children:[s("div",{class:"log-header",children:[s("h3",{children:"Log"}),s("button",{onClick:()=>{n([])},class:"small",children:"Clear"})]}),s("div",{class:"log-content",children:[t.map((r,o)=>s("div",{class:`log-entry log-${r.type}`,children:[s("span",{class:"log-time",children:["[",r.timestamp.toLocaleTimeString(),"]"]}),s("span",{class:"log-message",children:r.message})]},o)),s("div",{ref:i})]})]})}function Qe({ws:e,onSelectAssertion:t}){const[n,i]=S([]),[l,r]=S("all");R(()=>e.status!=="connected"?void 0:((()=>{e.sendRequest("assertion.failures").then(h=>{i(h.failures||[])}).catch(console.error)})(),e.subscribe("assertion",h=>{h.payload&&i(c=>[h.payload,...c].slice(0,200))})),[e.status]);const o=l==="all"?n:n.filter(_=>_.severity===l),d={warn:n.filter(_=>_.severity==="warn").length,error:n.filter(_=>_.severity==="error").length,fatal:n.filter(_=>_.severity==="fatal").length};return s("div",{class:"assertion-panel",children:[s("div",{class:"assertion-header",children:[s("h3",{children:"Assertions"}),s("div",{class:"assertion-filters",children:[s("button",{class:`filter-btn ${l==="all"?"active":""}`,onClick:()=>r("all"),children:["All (",n.length,")"]}),s("button",{class:`filter-btn severity-warn ${l==="warn"?"active":""}`,onClick:()=>r("warn"),children:["Warn (",d.warn,")"]}),s("button",{class:`filter-btn severity-error ${l==="error"?"active":""}`,onClick:()=>r("error"),children:["Error (",d.error,")"]}),s("button",{class:`filter-btn severity-fatal ${l==="fatal"?"active":""}`,onClick:()=>r("fatal"),children:["Fatal (",d.fatal,")"]})]})]}),s("div",{class:"assertion-content",children:o.length===0?s("div",{class:"empty",children:l==="all"?"No assertion failures":`No ${l} assertions`}):s("div",{class:"assertion-list",children:o.map((_,a)=>s("div",{class:`assertion-item severity-${_.severity}`,onClick:()=>t(_),children:[s("div",{class:"assertion-row",children:[s("span",{class:`assertion-badge severity-${_.severity}`,children:_.severity.toUpperCase()}),s("span",{class:"assertion-signal",children:_.signal_id}),s("span",{class:"assertion-tick",children:["Tick ",_.tick]})]}),s("div",{class:"assertion-message",children:_.message})]},a))})})]})}function Xe(){const e=je(`ws://${location.host}/ws`),[t,n]=S("signals"),[i,l]=S(null),[r,o]=S(null),[d,_]=S(0),a=()=>{window.location.reload()};R(()=>{if(e.status!=="connected")return;const c=e.subscribe("tick",p=>{"type"in p&&p.type==="tick"&&o(p.payload)});return e.sendRequest("status").then(p=>{p&&o(p)}).catch(console.error),c},[e.status]),R(()=>e.status!=="connected"?void 0:(e.sendRequest("assertion.failures").then(p=>{_((p.failures||[]).length)}).catch(console.error),e.subscribe("assertion",()=>{_(p=>p+1)})),[e.status]);const h=c=>{l({type:"assertion",data:c})};return s("div",{class:"app",children:[s(ze,{status:e.status,tickInfo:r,ws:e,hasErrors:d>0,onSimulationChange:a}),s("div",{class:"main-layout",children:[s(Ve,{currentTab:t,onTabChange:n,onSelectItem:l,ws:e}),s("div",{class:"center-panel",children:[s(Ge,{selectedItem:i,ws:e}),s(Ke,{ws:e})]}),s(Qe,{ws:e,onSelectAssertion:h})]})]})}De(s(Xe,{}),document.getElementById("app"));
